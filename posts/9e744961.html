<!DOCTYPE html><html lang="zh-CN" data-theme="light"><script>"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then((()=>{"true"!==localStorage.getItem("install")&&(localStorage.setItem("install","true"),location.reload())}))</script><head><div id="myscoll"></div><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>Linux系统移植篇(一)——Uboot移植 | Fomalhaut🥝</title><meta name="keywords" content="嵌入式,Linux驱动"><meta name="author" content="Fomalhaut🥝"><meta name="copyright" content="Fomalhaut🥝"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="🥭本文简单概括将Uboot移植至I.MX6ULL开发板的流程"><meta property="og:type" content="article"><meta property="og:title" content="Linux系统移植篇(一)——Uboot移植"><meta property="og:url" content="https://www.fomal.cc/posts/9e744961.html"><meta property="og:site_name" content="Fomalhaut🥝"><meta property="og:description" content="🥭本文简单概括将Uboot移植至I.MX6ULL开发板的流程"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://sourcebucket.s3.bitiful.net/img/default_cover_136.webp"><meta property="article:published_time" content="2023-03-28T21:00:00.000Z"><meta property="article:modified_time" content="2023-04-01T02:00:00.000Z"><meta property="article:author" content="Fomalhaut🥝"><meta property="article:tag" content="嵌入式"><meta property="article:tag" content="Linux驱动"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://sourcebucket.s3.bitiful.net/img/default_cover_136.webp"><link rel="shortcut icon" href="/"><link rel="canonical" href="https://www.fomal.cc/posts/9e744961"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/6.0.0/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:{appId:"0FLOBPS24V",apiKey:"614f2ca30a22eb184a406c931c2223dc",indexName:"fomal.cc",hits:{per_page:5},languages:{input_placeholder:"搜索文章",hits_empty:"找不到您查询的内容：${query}",hits_stats:"找到 ${hits} 条结果，用时 ${time} 毫秒"}},localSearch:void 0,translate:void 0,noticeOutdate:void 0,highlight:{plugin:"highlighjs",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:230},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!0,post:!0},runtime:"",date_suffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:void 0,lightbox:"fancybox",Snackbar:void 0,source:{justifiedGallery:{js:"https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.js",css:"https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.css"}},isPhotoFigcaption:!1,islazyload:!0,isAnchor:!1}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"Linux系统移植篇(一)——Uboot移植",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2023-04-01 02:00:00"}</script><noscript><style>#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,o){if(0===o)return;const n=864e5*o,a={value:t,expiry:(new Date).getTime()+n};localStorage.setItem(e,JSON.stringify(a))},get:function(e){const t=localStorage.getItem(e);if(!t)return;const o=JSON.parse(t);if(!((new Date).getTime()>o.expiry))return o.value;localStorage.removeItem(e)}},e.getScript=e=>new Promise(((t,o)=>{const n=document.createElement("script");n.src=e,n.async=!0,n.onerror=o,n.onload=n.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,t())},document.head.appendChild(n)})),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","ffffff")};const t=saveToLocal.get("theme");"dark"===t?activateDarkMode():"light"===t&&activateLightMode();const o=saveToLocal.get("aside-status");void 0!==o&&("hide"===o?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><link rel="stylesheet" href="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/element-ui/2.15.7/theme-chalk/index.css"><style id="themeColor"></style><style id="rightSide"></style><style id="transPercent"></style><style id="bgFilterParam"></style><span id="fps"></span><style id="defineBg"></style><style id="menu_shadow"></style><style id="nav-display"></style><style id="aside-show"></style><style id="aside-pos"></style><svg aria-hidden="true" style="position:absolute;overflow:hidden;width:0;height:0"><symbol id="icon-sun" viewBox="0 0 1024 1024"><path d="M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z" fill="#FFD878" p-id="8420"></path><path d="M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z" fill="#FFE4A9" p-id="8421"></path><path d="M512 109.248 626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z" fill="#4D5152" p-id="8422"></path><path d="M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z" fill="#4D5152" p-id="8423"></path></symbol><symbol id="icon-moon" viewBox="0 0 1024 1024"><path d="M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z" fill="#FFB531" p-id="11345"></path><path d="M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z" fill="#030835" p-id="11346"></path></symbol></svg><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload='this.media="all"'><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload='this.media="all"'><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload='this.media="screen"'><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.css" media="print" onload='this.media="all"'><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Fomalhaut🥝" type="application/atom+xml"></head><body><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><div class="loading-img"></div><div class="loading-image-dot"></div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.bitiful.net/img/avatar.webp" onerror='onerror=null,src="/assets/r1.jpg"' alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">49</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">58</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-home"></use></svg> <span class="menu_word" style="font-size:17px">首页</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon--article"></use></svg> <span class="menu_word" style="font-size:17px">文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-guidang1"></use></svg> <span class="menu_word" style="font-size:17px">归档</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-sekuaibiaoqian"></use></svg> <span class="menu_word" style="font-size:17px">标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-fenlei"></use></svg> <span class="menu_word" style="font-size:17px">分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:randomPost();"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-zuji1"></use></svg> <span class="menu_word" style="font-size:17px">随便逛逛</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-pinweishenghuo"></use></svg> <span class="menu_word" style="font-size:17px">休闲</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/life/music/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-yinle"></use></svg> <span class="menu_word" style="font-size:17px">八音盒</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/movies/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-dianying1"></use></svg> <span class="menu_word" style="font-size:17px">影院</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/games/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-youxishoubing"></use></svg> <span class="menu_word" style="font-size:17px">游戏</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-xiangzi"></use></svg> <span class="menu_word" style="font-size:17px">八宝箱</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/box/gallery/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-tubiaozhizuomoban"></use></svg> <span class="menu_word" style="font-size:17px">画廊</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/animation/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-nvwumao"></use></svg> <span class="menu_word" style="font-size:17px">动画</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/nav/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-zhifengche"></use></svg> <span class="menu_word" style="font-size:17px">网址导航</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-shejiaoxinxi"></use></svg> <span class="menu_word" style="font-size:17px">社交</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/social/fcircle/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-pengyouquan"></use></svg> <span class="menu_word" style="font-size:17px">朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-liuyan"></use></svg> <span class="menu_word" style="font-size:17px">留言板</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/social/link/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-lianjie"></use></svg> <span class="menu_word" style="font-size:17px">友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-wangye"></use></svg> <span class="menu_word" style="font-size:17px">网站</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/site/census/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon--tongjibiao"></use></svg> <span class="menu_word" style="font-size:17px">网站统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/echarts/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-shujutongji1"></use></svg> <span class="menu_word" style="font-size:17px">文章统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/time/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-xianxingshalou"></use></svg> <span class="menu_word" style="font-size:17px">旧时光</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-maoliang"></use></svg> <span class="menu_word" style="font-size:17px">个人</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/personal/bb/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-qunliaotian"></use></svg> <span class="menu_word" style="font-size:17px">唠叨</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/personal/love/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-love-sign"></use></svg> <span class="menu_word" style="font-size:17px">恋爱小屋</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/personal/about/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-paperplane"></use></svg> <span class="menu_word" style="font-size:17px">关于</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Fomalhaut🥝</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-home"></use></svg> <span class="menu_word" style="font-size:17px">首页</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon--article"></use></svg> <span class="menu_word" style="font-size:17px">文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-guidang1"></use></svg> <span class="menu_word" style="font-size:17px">归档</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-sekuaibiaoqian"></use></svg> <span class="menu_word" style="font-size:17px">标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-fenlei"></use></svg> <span class="menu_word" style="font-size:17px">分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:randomPost();"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-zuji1"></use></svg> <span class="menu_word" style="font-size:17px">随便逛逛</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-pinweishenghuo"></use></svg> <span class="menu_word" style="font-size:17px">休闲</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/life/music/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-yinle"></use></svg> <span class="menu_word" style="font-size:17px">八音盒</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/movies/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-dianying1"></use></svg> <span class="menu_word" style="font-size:17px">影院</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/games/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-youxishoubing"></use></svg> <span class="menu_word" style="font-size:17px">游戏</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-xiangzi"></use></svg> <span class="menu_word" style="font-size:17px">八宝箱</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/box/gallery/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-tubiaozhizuomoban"></use></svg> <span class="menu_word" style="font-size:17px">画廊</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/animation/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-nvwumao"></use></svg> <span class="menu_word" style="font-size:17px">动画</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/nav/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-zhifengche"></use></svg> <span class="menu_word" style="font-size:17px">网址导航</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-shejiaoxinxi"></use></svg> <span class="menu_word" style="font-size:17px">社交</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/social/fcircle/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-pengyouquan"></use></svg> <span class="menu_word" style="font-size:17px">朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-liuyan"></use></svg> <span class="menu_word" style="font-size:17px">留言板</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/social/link/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-lianjie"></use></svg> <span class="menu_word" style="font-size:17px">友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-wangye"></use></svg> <span class="menu_word" style="font-size:17px">网站</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/site/census/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon--tongjibiao"></use></svg> <span class="menu_word" style="font-size:17px">网站统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/echarts/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-shujutongji1"></use></svg> <span class="menu_word" style="font-size:17px">文章统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/time/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-xianxingshalou"></use></svg> <span class="menu_word" style="font-size:17px">旧时光</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-maoliang"></use></svg> <span class="menu_word" style="font-size:17px">个人</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/personal/bb/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-qunliaotian"></use></svg> <span class="menu_word" style="font-size:17px">唠叨</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/personal/love/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-love-sign"></use></svg> <span class="menu_word" style="font-size:17px">恋爱小屋</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/personal/about/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-paperplane"></use></svg> <span class="menu_word" style="font-size:17px">关于</span></a></li></ul></div></div><center id="name-container"><a id="page-name" href="javascript:scrollToTop()">PAGE_NAME</a></center><div id="nav-right"><div id="search-button"><a class="search faa-parent animated-hover" title="检索站内任何你想要的信息"><svg class="faa-tada icon" style="height:24px;width:24px;fill:currentColor;position:relative;top:6px" aria-hidden="true"><use xlink:href="#icon-valentine_-search-love-find-heart"></use></svg> <span>搜索</span></a></div><a class="meihua faa-parent animated-hover" onclick="toggleWinbox()" title="美化设置-自定义你的风格" id="meihua-button"><svg class="faa-tada icon" style="height:26px;width:26px;fill:currentColor;position:relative;top:8px" aria-hidden="true"><use xlink:href="#icon-picture"></use></svg></a><a class="sun_moon faa-parent animated-hover" onclick="switchNightMode()" title="浅色和深色模式转换" id="nightmode-button"><svg class="faa-tada" style="height:25px;width:25px;fill:currentColor;position:relative;top:7px" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon"></use></svg></a><div id="toggle-menu"><a><i class="fas fa-bars fa-fw"></i></a></div></div></div></nav><div id="post-info"><h1 class="post-title">Linux系统移植篇(一)——Uboot移植</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><svg class="meta_icon post-meta-icon" style="width:30px;height:30px;position:relative;top:10px"><use xlink:href="#icon-rili"></use></svg><span class="post-meta-label">发表于</span> <time class="post-meta-date-created" datetime="2023-03-28T21:00:00.000Z" title="发表于 2023-03-28 21:00:00">2023-03-28</time><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:18px;height:18px;position:relative;top:5px"><use xlink:href="#icon-gengxin1"></use></svg><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-04-01T02:00:00.000Z" title="更新于 2023-04-01 02:00:00">2023-04-01</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:18px;height:18px;position:relative;top:5px"><use xlink:href="#icon-biaoqian"></use></svg><a class="post-meta-categories" href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93/">嵌入式知识点总结</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><svg class="meta_icon post-meta-icon" style="width:25px;height:25px;position:relative;top:8px"><use xlink:href="#icon-charuword"></use></svg><span class="post-meta-label">字数总计:</span><span class="word-count">1.2w</span><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:20px;height:20px;position:relative;top:5px"><use xlink:href="#icon-shizhong"></use></svg><span class="post-meta-label">阅读时长:</span><span>45分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title="Linux系统移植篇(一)——Uboot移植"><svg class="meta_icon post-meta-icon" style="width:25px;height:25px;position:relative;top:5px"><use xlink:href="#icon-eye"></use></svg><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s58 18 88 18 58-18 88-18 58 18 88 18v44h-352Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="1-NXP-官方开发板-uboot-编译测试">1.NXP 官方开发板 uboot 编译测试</h2><h3 id="1-1-查找-NXP-官方的开发板默认配置文件">1.1 查找 NXP 官方的开发板默认配置文件</h3><ul><li><p>uboot 移植并不是完完全全从零开始将 uboot 移植到我们现在所使用的开发板或者开发平台上。这个对于我们来说基本是不可能的，这个工作一般是半导体厂商做的，半导体厂商负责将 uboot 移植到他们的芯片上，因此半导体厂商都会自己做一个开发板，这个开发板就叫做原厂开发板，比如大家学习 STM32 时听说过的 discover 开发板就是 ST 自己做的。半导体厂商会将 uboot 移植到他们自己的原厂开发板上，测试好以后就会将这个 uboot 发布出去，这就是大家常说的原厂 BSP 包。我们一般做产品的时候就会<strong>参考原厂的开发板做硬件，然后在原厂提供的 BSP 包上做修改，将 uboot 或者 linux kernel 移植到我们的硬件上</strong>。这个就是 uboot 移植的一般流程：</p><ol><li>在 uboot 中找到参考的开发平台，一般是原厂的开发板。</li><li>参考原厂开发板移植 uboot 到我们所使用的开发板上。</li></ol></li><li><p>正点原子的 I.MX6ULL 开发板参考的是 NX 官方的 I.MX6ULL EVK 开发板做的硬件，因此我们在移植 uboot 时就可以以 NXP 官方的 I.MX6ULL EVK 开发板为蓝本。</p></li><li><p>本章我们是将 NXP 官方的 uboot 移植到正点原子的 I.MX6ULL 开发板上在移植之前，我们先编译一下 NXP 官方 I.MX6ULL EVK 开发板对应的 uboot，首先是配置 uboot，<code>configs</code> 录下有很多跟 I.MX6UL/6ULL 有关的配置如下图所示：</p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://tuchuang.voooe.cn/images/2023/03/28/I.MX6ULinuxV1.8.webp" style="zoom:50%"></li><li><p>从图中可以看出有很多的默认配置文件，其中以 <code>mx6ul</code> 开头的是 I.MX6UL 芯片的，mx6ull 开头的是 I.MX6ULL 开发板的。I.MX6UL/6ULL 有 9x9mm 和 14x14mm 两种尺寸的，所以我们可以看到会有 mx6ull_9x9 和 mx6ull_14x14 开头的默认配置文件。我们使用的是 14x14mm 的芯片，所以关注 mx6ull_14x14 开头的默认配置文件。正点原子的 I.MX6ULL 有 EMMC 和 NAND 两个版本的，因此我们最终只需要关注 <code>mx6ull_14x14_evk_emmc_defconfig</code> 和<code>mx6ull_14x14_evk_nand_defconfig</code> 这两个配置文件就行了。本章我们讲解 EMMC 版本的移植（NAND 版本移植很多类似），所以使用<code>mx6ull_14x14_evk_emmc_defconfig</code> 作为默认配置文件。</p></li></ul><h3 id="1-2-编译-NXP-官方开发板对应的-uboot">1.2 编译 NXP 官方开发板对应的 uboot</h3><ul><li><p>找到 NXP 官方 I.MX6ULL EVK 开发板对应的默认配置文件以后就可以编译一下，使用如下命令编译 uboot：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- mx6ull_14x14_evk_emmc_defconfig</span><br><span class="line">make V=1 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- -j16</span><br></pre></td></tr></table></figure></li><li><p>在编译的时候需要输入<code>ARCH</code> 和<code>CORSS_COMPILE</code>这两个变量的值，这样太麻烦了。我们可以直接在顶层 <code>Makefile</code> 中直接给 <code>ARCH</code> 和<code>CORSS_COMPILE</code> 赋值：</p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://tuchuang.voooe.cn/images/2023/03/28/I.MX6ULinuxV1.815e2821ae7139ef0.png" style="zoom:80%"></li><li><p>250、251 行就是直接给 <code>ARCH</code> 和 <code>CROSS_COMPILE</code> 赋值，这样我们就可以使用如下简短的命令来编译 uboot：</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make mx6ull_14x14_evk_emmc_defconfig</span><br><span class="line">make V=1 -j16</span><br></pre></td></tr></table></figure><ul><li><p>如果既不想修改 uboot 的顶层 Makefile，又想编译的时候不用输入那么多，那么就直接创建个 shell 脚本就行了，shell 脚本名为 <code>mx6ull_14x14_emmc.sh</code>，然后在 shell 脚本里面输入如下内容：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- distclean</span><br><span class="line">make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- mx6ull_14x14_evk_emmc_defconfig</span><br><span class="line">make V=1 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- -j16</span><br></pre></td></tr></table></figure></li><li><p>记得给<code>mx6ull_14x14_emmc.sh</code> 这个文件可执行权限，使用 <code>mx6ull_14x14_emmc.sh</code> 脚本编译 uboot 的时候每次都会清理一下工程，然后全部重新编译，编译的时候直接执行这个脚本就行了，命令如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./mx6ull_14x14_evk_emmc.sh</span><br></pre></td></tr></table></figure></li><li><p>编译完成以后会生成<code>u-boot.bin</code>、<code>u-boot.imx</code> 等文件，但是这些文件是 NXP 官方 I.MX6ULL EVK 开发板。能不能用到正点原子的 I.MX6ULL 开发板上呢？试一下不就知道了！</p></li></ul><h3 id="1-3-烧写验证与驱动测试">1.3 烧写验证与驱动测试</h3><ul><li><p>将 imxdownload 软件拷贝到 uboot 源码根目录下，然后使用 imxdownload 软件将 <code>u-boot.bin</code>烧写到 SD 卡中，烧写命令如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod 777 imxdownload //给予 imxdownload 可执行权限</span><br><span class="line">./imxdownload u-boot.bin /dev/sdd //烧写到 SD 卡中，不能烧写到/dev/sda 或 sda1 里面</span><br></pre></td></tr></table></figure></li><li><p>烧写完成以后将 SD 卡插入 I.MX6U-ALPHA 开发板的 TF 卡槽中，最后设置开发板从 SD 卡启动。打开 SecureCRT，设置好开发板所使用的串口并打开，复位开发板，SecureCRT 接收到如下图所示信息：</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://tuchuang.voooe.cn/images/2023/03/28/I.MX6ULinuxV1.8cd2d02997534778a.webp" alt=""></p></li><li><p>从图可以看出，uboot 启动正常，虽然我们用的是 NXP 官方 I.MX6ULL 开发板的 uboot，但是在正点原子的 I.MX6ULL 开发板上是可以正常启动的。而且 DRAM 识别正确，为 512MB，如果用的 NAND 版本的核心版的话 uboot 启动会失败！因为 NAND 核心版用的 256MB 的 DRAM。</p></li></ul><ol><li><p>SD 卡和 EMMC 驱动检查</p><ul><li><p>检查 SD 卡和 EMMC 驱动是否正常，使用命令 <code>mmc list</code> 列出当前的 MMC 设备，结果如图所示：</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://tuchuang.voooe.cn/images/2023/03/28/I.MX6ULinuxV1.86e1d1d7943901146.png" alt=""></p></li><li><p>从图 33.1.3.2 可以看出当前有两个 MMC 设备，检查每个 MMC 设备信息，先检查 MMC 设备 0，输入如下命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mmc dev 0</span><br><span class="line">mmc info</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://tuchuang.voooe.cn/images/2023/03/28/I.MX6ULinuxV1.888740a6198c865fa.webp" alt=""></p></li><li><p>可以看出，mmc 设备 0 是 SD 卡，SD 卡容量为 14.8GB，这个和我所使用的 SD 卡信息相符，说明 SD 卡驱动正常。再来检查 MMC 设备 1，输入如下命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mmc dev 1</span><br><span class="line">mmc info</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://tuchuang.voooe.cn/images/2023/03/28/I.MX6ULinuxV1.805d18e528f3a5447.webp" alt=""></p></li><li><p>可以看出，mmc 设备 1 为 EMMC，容量为 7.3GB，说明 EMMC 驱动也成功，SD 卡和 EMMC 的驱动都没问题。</p></li></ul></li><li><p>LCD 驱动检查</p><ul><li>如果 uboot 中的 LCD 驱动正确的话，启动 uboot 以后 LCD 上应该会显示出 NXP 的 logo</li></ul></li><li><p>网络驱动</p><ul><li><p>uboot 启动的时候提示“Board Net Initialization Failed”和“No ethernet found.”这两行，说明网络驱动也有问题，正常情况下应该是如下图所示：</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://tuchuang.voooe.cn/images/2023/03/28/I.MX6ULinuxV1.8b996bc095e39ed8c.webp" alt=""></p></li><li><p>现在没有图中的信息，说明当前 uboot 的网络部驱动也是有问题的，这是因为正点原子开发板的网络芯片<strong>复位引脚</strong>和 NXP 官方开发板不一样，因此需要修改驱动。</p></li><li><p>总结一下 NXP 官方 I.MX6ULL EVK 开发板的 uboot 在正点原子 EMMC 版本 I.MX6ULL 开发板上的运行情况：</p><ol><li>uboot 启动正常，DRAM 识别正确，SD 卡和 EMMC 驱动正常。</li><li>uboot 里面的 LCD 驱动默认是给 4.3 寸 480x272 分辨率的，如果使用的其他分辨率的屏幕需要修改驱动。</li><li>网络不能工作，识别不出来网络信息，需要修改驱动。 接下来我们要做的工作如下：</li><li>前面我们一直使用着 NXP 官方开发板的 uboot 配置，接下来需要在 uboot 中添加我们自己的开发板，也就是正点原子的 I.MX6ULL 开发板。</li><li>解决 LCD 驱动和网络驱动的问题。</li></ol></li></ul></li></ol><h2 id="2-在-U-Boot-中添加自己的开发板">2.在 U-Boot 中添加自己的开发板</h2><ul><li>NXP 官方 uboot 中默认都是 NXP 自己的开发板，虽说我们可以直接在官方的开发板上直接修改，使 uboot 可以完整的运行在我们的板子上。但是从学习的角度来讲，这样我们就不能了解到 uboot 是如何添加新平台的。接下来我们就参考 NXP 官方的 I.MX6ULL EVK 开发板，学习如何在 uboot 中添加我们的开发板或者开发平台。</li></ul><h3 id="2-1-添加开发板默认配置文件">2.1 添加开发板默认配置文件</h3><ul><li><p>先在 configs 目录下创建默认配置文件，复制 <code>mx6ull_14x14_evk_emmc_defconfig</code>，然后重命名为 <code>mx6ull_alientek_emmc_defconfig</code>，命令如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd configs</span><br><span class="line">cp mx6ull_14x14_evk_emmc_defconfig mx6ull_alientek_emmc_defconfig</span><br></pre></td></tr></table></figure></li><li><p>然后将文件 <code>mx6ull_alientek_emmc_defconfig</code> 中的内容改成下面的：</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CONFIG_SYS_EXTRA_OPTIONS=<span class="string">&quot;IMX_CONFIG=board/freescale/mx6ull_alientek_emmc/imximage.cfg,MX6ULL_EVK_EMMC_REWORK&quot;</span></span><br><span class="line">CONFIG_ARM=y</span><br><span class="line">CONFIG_ARCH_MX6=y</span><br><span class="line">CONFIG_TARGET_MX6ULL_ALIENTEK_EMMC=y</span><br><span class="line">CONFIG_CMD_GPIO=y</span><br></pre></td></tr></table></figure></li><li><p>可以看出<code>mx6ull_alientek_emmc_defconfig</code> 基本和 <code>mx6ull_14x14_evk_emmc_defconfig</code> 中的内容一样，只是第 1 行和第 4 行做了修改。</p></li></ul><h3 id="2-2-添加开发板对应的头文件">2.2 添加开发板对应的头文件</h3><ul><li><p>在目录 <code>include/configs</code> 下添加 I.MX6ULL-ALPHA 开发板对应的头文件，复制<code>include/configs/mx6ullevk.h</code>，并重命名为 <code>mx6ull_alientek_emmc.h</code>，命令如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp include/configs/mx6ullevk.h include/configs/mx6ull_alientek_emmc.h</span><br></pre></td></tr></table></figure></li><li><p>拷贝完成以后将：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __MX6ULLEVK_CONFIG_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __MX6ULLEVK_CONFIG_H</span></span><br></pre></td></tr></table></figure></li><li><p>改为：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __MX6ULL_ALIENTEK_EMMC_CONFIG_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __MX6ULL_ALIENTEK_EMMC_CONFIG_H</span></span><br></pre></td></tr></table></figure></li><li><p><code>mx6ull_alientek_emmc.h</code> 里面有很多宏定义，这些宏定义基本用于配置 uboot，也有一些 I.MX6ULL 的配置项目。如果我们自己要想使能或者禁止 uboot 的某些功能，那就在<code>mx6ull_alientek_emmc.h</code> 里面做修改即可。<code>mx6ull_alientek_emmc.h</code> 里面的内容比较多，去掉一些用不到的配置，精简后的内容如下(略)：</p></li><li><p>可以看出，<code>mx6ull_alientek_emmc.h</code> 文件中基本都是&quot;CONFIG_&quot;开头的宏定义，这也说明 <code>mx6ull_alientek_emmc.h</code> 文件的主要功能就是配置或者裁剪 uboot。如果需要某个功能的话就在里面添加这个功能对应的 CONFIG_XXX 宏即可，如果不需要某个功能的话就删除掉对应的宏即可。我们详细的看一下 mx6ull_alientek_emmc.h 中这些宏都是什么功能：</p><ul><li>宏 <code>PHYS_SDRAM_SIZE</code> 就是板子上 DRAM 的大小、</li><li>宏 <code>CONFIG_DISPLAY_CPUINFO</code>，uboot 启动的时候可以输出 CPU 信息</li><li>宏 <code>CONFIG_DISPLAY_BOARDINFO</code>，uboot 启动的时候可以输出板子信息</li><li>宏 <code>CONFIG_SYS_MALLOC_LEN</code> 为 malloc 内存池大小，这里设置为 16MB</li><li>宏 <code>CONFIG_MXC_UART_BASE</code> 表示串口寄存器基地址</li><li>宏 <code>CONFIG_SYS_FSL_ESDHC_ADDR</code> 为 EMMC 所使用接口的寄存器基地址</li><li>和 I2C 有关的宏定义，用于控制使能哪个 I2C，I2C 的速度为多少</li><li>宏 <code>CONFIG_MFG_ENV_SETTINGS</code> 定义了一些环境变量，使用 MfgTool 烧写系统时候会用到这里面的环境变量</li><li>宏 <code>CONFIG_EXTRA_ENV_SETTINGS</code> 也是设置一些环境变量</li><li>宏 <code>CONFIG_SYS_LOAD_ADDR</code> 表示 linux kernel 在 DRAM 中的加载地址，也就是 linux kernel 在 DRAM 中的存储首地址，<code>CONFIG_LOADADDR</code>=0X80800000</li><li>宏 <code>CONFIG_SYS_HZ</code> 为系统时钟频率，这里为 1000Hz</li><li>宏 <code>PHYS_SDRAM</code> 为 I.MX6ULL 的 DRAM 控制器 MMDC0 所管辖的 DRAM 范围起始地址，也就是 0X80000000</li><li>…</li></ul></li><li><p>关于 <code>mx6ull_alientek_emmc.h</code> 就讲解到这里，其中以 <code>CONFIG_CMD</code> 开头的宏都是用于使能相应命令的，其他的以 <code>CONFIG</code> 开头的宏都是完成一些配置功能的。以后会频繁的和<code>mx6ull_alientek_emmc.h</code> 这个文件打交道。</p></li></ul><h3 id="2-3-添加开发板对应的板级文件夹">2.3 添加开发板对应的板级文件夹</h3><ul><li><p>uboot 中每个板子都有一个对应的文件夹来存放板级文件，比如开发板上外设驱动文件等等。NXP 的 <a target="_blank" rel="noopener" href="http://I.MX">I.MX</a> 系列芯片的所有板级文件夹都存放在 <code>board/freescale</code> 目录下，在这个目录下有个名为 <code>mx6ullevk</code> 的文件夹，这个文件夹就是 NXP 官方 I.MX6ULL EVK 开发板的板级文件夹。复制 <code>mx6ullevk</code>，将其重命名为 <code>mx6ull_alientek_emmc</code>，命令如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd board/freescale/</span><br><span class="line">cp mx6ullevk/ -r mx6ull_alientek_emmc</span><br></pre></td></tr></table></figure></li><li><p>进 入 <code>mx6ull_alientek_emmc</code> 目 录 中 ， 将 其 中 的 <code>mx6ullevk.c</code> 文 件 重 命 名 为<code>mx6ull_alientek_emmc.c</code>，命令如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd mx6ull_alientek_emmc</span><br><span class="line">mv mx6ullevk.c mx6ull_alientek_emmc.c</span><br></pre></td></tr></table></figure></li><li><p>我们还需要对 <code>mx6ull_alientek_emmc</code> 目录下的文件做一些修改：</p><ol><li><p>修改<code>mx6ull_alientek_emmc</code> 目录下的 <code>Makefile</code> 文件 ：</p><p>将 mx6ull_alientek_emmc 下的 Makefile 文件内容改为如下所示：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># (C) Copyright <span class="number">2015</span> Freescale Semiconductor, Inc.</span><br><span class="line">#</span><br><span class="line"># SPDX-License-Identifier:   GPL<span class="number">-2.0</span>+</span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">obj-y  := mx6ull_alientek_emmc.o</span></span><br><span class="line"></span><br><span class="line">extra-$(CONFIG_USE_PLUGIN) :=  plugin.bin</span><br><span class="line">$(obj)/plugin.bin: $(obj)/plugin.o</span><br><span class="line"> $(OBJCOPY) -O binary --gap-fill <span class="number">0xff</span> $&lt; $@</span><br></pre></td></tr></table></figure><p>重点是第 6 行的<code>obj-y</code>，改为<code>mx6ull_alientek_emmc.o</code>，这样才会编译<code>mx6ull_alientek_emmc.c</code>这个文件。</p></li><li><p>修改<code>mx6ull_alientek_emmc</code> 目录下的 <code>imximage.cfg</code> 文件，将 imximage.cfg 中的下面一句：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PLUGIN board/freescale/mx6ullevk/plugin.bin 0x00907000</span><br></pre></td></tr></table></figure><p>改为：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PLUGIN board/freescale/mx6ull_alientek_emmc/plugin.bin 0x00907000</span><br></pre></td></tr></table></figure></li><li><p>修改<code>mx6ull_alientek_emmc</code> 目录下的 Kconfig 文件</p><p>修改 Kconfig 文件，修改后的内容如下：</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">if TARGET_MX6ULL_ALIENTEK_EMMC</span><br><span class="line">  </span><br><span class="line">config SYS_BOARD</span><br><span class="line"> default <span class="string">&quot;mx6ull_alientek_emmc&quot;</span></span><br><span class="line">  </span><br><span class="line">config SYS_VENDOR</span><br><span class="line"> default <span class="string">&quot;freescale&quot;</span></span><br><span class="line">  </span><br><span class="line">config SYS_SOC</span><br><span class="line"> default <span class="string">&quot;mx6&quot;</span></span><br><span class="line">  </span><br><span class="line">config SYS_CONFIG_NAME</span><br><span class="line"> default <span class="string">&quot;mx6ull_alientek_emmc&quot;</span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure></li><li><p>修改 <code>mx6ull_alientek_emmc</code> 目录下的 <code>MAINTAINERS</code> 文件</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MX6ULL_ALIENTEK_EMMC BOARD</span><br><span class="line"><span class="section">M:    Peng Fan &lt;peng.fan@nxp.com&gt;</span></span><br><span class="line"><span class="section">S:    Maintained</span></span><br><span class="line"><span class="section">F:    board/freescale/mx6ull_alientek_emmc/</span></span><br><span class="line"><span class="section">F:    include/configs/mx6ull_alientek_emmc.h</span></span><br></pre></td></tr></table></figure></li></ol></li></ul><h3 id="2-4-修改-U-Boot-图形界面配置文件">2.4 修改 U-Boot 图形界面配置文件</h3><ul><li><p>uboot 是支持图形界面配置，修改文件<code>arch/arm/cpu/armv7/mx6/Kconfig</code>(如果用的 I.MX6UL 的话，应该修改 arch/arm/Kconfig 这个文件)，在 207 行加入如下内容：</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">config TARGET_MX6ULL_ALIENTEK_EMMC</span><br><span class="line"> bool <span class="string">&quot;Support mx6ull_alientek_emmc&quot;</span></span><br><span class="line"> select MX6ULL</span><br><span class="line"> select DM</span><br><span class="line"> select DM_THERMAL</span><br></pre></td></tr></table></figure></li><li><p>在最后一行的 endif 的前一行添加如下内容：</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source <span class="string">&quot;board/freescale/mx6ull_alientek_emmc/Kconfig&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>添加完成以后的 Kconfig 文件如图所示：</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://tuchuang.voooe.cn/images/2023/03/28/I.MX6ULinuxV1.8-1.webp" alt=""></p></li><li><p>到此为止，I.MX6U-ALPHA 开发板就已经添加到 uboot 中了，接下来就是编译这个新添加的开发板。</p></li></ul><h3 id="2-5-使用新添加的板子配置编译-uboot">2.5 使用新添加的板子配置编译 uboot</h3><ul><li><p>在 uboot 根目录下新建一个名为 <code>mx6ull_alientek_emmc.sh</code> 的 shell 脚本，在这个 shell 脚本里面输入如下内容：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- distclean</span><br><span class="line">make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- mx6ull_alientek_emmc_defconfig</span><br><span class="line">make V=1 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- -j16</span><br></pre></td></tr></table></figure></li><li><p>第 3 行我们使用的默认配置文件就是刚刚新建的<code>mx6ull_alientek_emmc_defconfig</code> 这个配置文件。给予 <code>mx6ll_alientek_emmc.sh</code> 可执行权限，然后运行脚本来完成编译，命令如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod 777 mx6ull_alientek_emmc.sh //给予可执行权限，一次即可</span><br><span class="line">./mx6ull_alientek_emmc.sh //运行脚本编译 uboot</span><br></pre></td></tr></table></figure></li><li><p>等待编译完成，编译完成以后输入如下命令，查看一下<code>mx6ull_alientek_emmc.h</code> 这个头文件有没有被引用：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -nR &quot;mx6ull_alientek_emmc.h&quot;</span><br></pre></td></tr></table></figure></li><li><p>如果有很多文件都引用了<code>mx6ull_alientek_emmc.h</code> 这个头文件，那就说明新板子添加成功：</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://tuchuang.voooe.cn/images/2023/03/28/I.MX6ULinuxV1.8-2.webp" alt=""></p></li><li><p>编译完成以后就使用 imxdownload 将新编译出来的 u-boot.bin 烧写到 SD 卡中测试，SecureCRT 输出结果如图所示：</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://tuchuang.voooe.cn/images/2023/03/28/I.MX6ULinuxV1.8-3.webp" alt=""></p></li><li><p>此时的 Board 还是“MX6ULL 14x14 EVK”，因为我们参考的 NXP 官方的 I.MX6ULL 开发板来添加自己的开发板。如果接了 LCD 屏幕的话会发现 LCD 屏幕并没有显示 NXP 的 logo，而且此时的网络同样也没识别出来。前面已经说了，默认 uboot 中的 LCD 驱动和网络驱动在正点原子的 I.MX6U-ALPHA 开发板上是有问题的，需要修改。</p></li></ul><h3 id="2-6-LCD-驱动修改">2.6 LCD 驱动修改</h3><ul><li><p>一般 uboot 中修改驱动基本都是在 xxx.h 和 xxx.c 这两个文件中进行的，xxx 为板子名称，比如 <code>mx6ull_alientek_emmc.h</code> 和 <code>mx6ull_alientek_emmc.c</code> 这两个文件。 一般修改 LCD 驱动重点注意以下几点：</p><ol><li>LCD 所使用的 GPIO，查看 uboot 中 LCD 的 IO 配置是否正确。</li><li>LCD 背光引脚 GPIO 的配置。</li><li>LCD 配置参数是否正确。</li></ol></li><li><p>正点原子的 I.MX6U-ALPHA 开发板 LCD 原理图和 NXP 官方 I.MX6ULL 开发板一致，也就是 LCD 的 IO 和背光 IO 都一样的，所以 IO 部分就不用修改了。需要修改的之后 LCD 参数，打开文件 <code>mx6ull_alientek_emmc.c</code>，找到如下所示内容：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">display_info_t</span> <span class="title">const</span> <span class="title">displays</span>[] =</span> &#123;&#123;</span><br><span class="line"> .bus = MX6UL_LCDIF1_BASE_ADDR,</span><br><span class="line"> .addr = <span class="number">0</span>,</span><br><span class="line"> .pixfmt = <span class="number">24</span>,</span><br><span class="line"> .detect = <span class="literal">NULL</span>,</span><br><span class="line"> .enable = do_enable_parallel_lcd,</span><br><span class="line"> .mode = &#123;</span><br><span class="line"> .name = <span class="string">&quot;TFT43AB&quot;</span>,</span><br><span class="line"> .xres = <span class="number">480</span>,</span><br><span class="line"> .yres = <span class="number">272</span>,</span><br><span class="line"> .pixclock = <span class="number">108695</span>,</span><br><span class="line"> .left_margin = <span class="number">8</span>,</span><br><span class="line"> .right_margin = <span class="number">4</span>,</span><br><span class="line"> .upper_margin = <span class="number">2</span>,</span><br><span class="line"> .lower_margin = <span class="number">4</span>,</span><br><span class="line"> .hsync_len = <span class="number">41</span>,</span><br><span class="line"> .vsync_len = <span class="number">10</span>,</span><br><span class="line"> .sync = <span class="number">0</span>,</span><br><span class="line"> .vmode = FB_VMODE_NONINTERLACED</span><br><span class="line">&#125; &#125; &#125;;</span><br></pre></td></tr></table></figure></li><li><p>代码中定义了一个变量 <code>displays</code>，类型为 <code>display_info_t</code>，这个结构体是 LCD 信息结构体，其中包括了 LCD 的分辨率，像素格式，LCD 的各个参数等。<code>display_info_t</code> 定义在文件 <code>arch/arm/include/asm/imx-common/video.h</code> 中，定义如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">display_info_t</span> &#123;</span></span><br><span class="line"> <span class="type">int</span> bus;</span><br><span class="line"> <span class="type">int</span> addr;</span><br><span class="line"> <span class="type">int</span> pixfmt;</span><br><span class="line"> <span class="type">int</span> (*detect)(<span class="keyword">struct</span> <span class="type">display_info_t</span> <span class="type">const</span> *dev);</span><br><span class="line"> <span class="type">void</span> (*enable)(<span class="keyword">struct</span> <span class="type">display_info_t</span> <span class="type">const</span> *dev);</span><br><span class="line"> <span class="class"><span class="keyword">struct</span> <span class="title">fb_videomode</span> <span class="title">mode</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li><li><p>pixfmt 是像素格式，也就是一个像素点是多少位，如果是 RGB565 的话就是 16 位，如果是 888 的话就是 24 位，一般使用 RGB888。结构体 <code>display_info_t</code> 还有个 mode 成员变量，此成员变量也是个结构体，为<code>fb_videomode</code>，定义在文件 <code>include/linux/fb.h</code> 中，定义如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">fb_videomode</span> &#123;</span></span><br><span class="line"> <span class="type">const</span> <span class="type">char</span> *name; <span class="comment">/* optional */</span></span><br><span class="line"> u32 refresh; <span class="comment">/* optional */</span></span><br><span class="line"> u32 xres;</span><br><span class="line"> u32 yres;</span><br><span class="line"> u32 pixclock;</span><br><span class="line"> u32 left_margin;</span><br><span class="line"> u32 right_margin;</span><br><span class="line"> u32 upper_margin;</span><br><span class="line"> u32 lower_margin;</span><br><span class="line"> u32 hsync_len;</span><br><span class="line"> u32 vsync_len;</span><br><span class="line"> u32 sync;</span><br><span class="line"> u32 vmode;</span><br><span class="line"> u32 flag;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li><li><p>结构体 fb_videomode 里面的成员变量为 LCD 的参数，这些成员变量函数如下：</p></li><li><p>name：LCD 名字，要和环境变量中的 panel 相等。</p></li><li><p>xres、yres：LCD X 轴和 Y 轴像素数量。</p></li><li><p>pixclock：像素时钟，每个像素时钟周期的长度，单位为皮秒。</p></li><li><p>left_margin：HBP，水平同步后肩。</p></li><li><p>right_margin：HFP，水平同步前肩。</p></li><li><p>upper_margin：VBP，垂直同步后肩。</p></li><li><p>lower_margin：VFP，垂直同步前肩。</p></li><li><p>hsync_len：HSPW，行同步脉宽。</p></li><li><p>vsync_len：VSPW，垂直同步脉宽。</p></li><li><p>vmode：大多数使用 FB_VMODE_NONINTERLACED，也就是不使用隔行扫描。</p></li><li><p>可以看出，这些参数和我们第二十四章讲解 RGB LCD 的时候参数基本一样，唯一不同的像素时钟 pixclock 的含义不同，以正点原子的 7 寸 1024*600 分辨率的屏幕(ATK7016)为例，屏幕要求的像素时钟为 51.2MHz，因此：<code>pixclock=(1/51200000)*10^12=19531</code></p></li><li><p>再根据其他的屏幕参数，可以得出 ATK7016 屏幕的配置参数如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">display_info_t</span> <span class="title">const</span> <span class="title">displays</span>[] =</span> &#123;&#123;</span><br><span class="line"> .bus = MX6UL_LCDIF1_BASE_ADDR,</span><br><span class="line"> .addr = <span class="number">0</span>,</span><br><span class="line"> .pixfmt = <span class="number">24</span>,</span><br><span class="line"> .detect = <span class="literal">NULL</span>,</span><br><span class="line"> .enable = do_enable_parallel_lcd,</span><br><span class="line"> .mode = &#123;</span><br><span class="line"> .name = <span class="string">&quot;TFT7016&quot;</span>,</span><br><span class="line"> .xres = <span class="number">1024</span>,</span><br><span class="line"> .yres = <span class="number">600</span>,</span><br><span class="line"> .pixclock = <span class="number">19531</span>,</span><br><span class="line"> .left_margin = <span class="number">140</span>, <span class="comment">//HBPD</span></span><br><span class="line"> .right_margin = <span class="number">160</span>, <span class="comment">//HFPD</span></span><br><span class="line"> .upper_margin = <span class="number">20</span>, <span class="comment">//VBPD</span></span><br><span class="line"> .lower_margin = <span class="number">12</span>, <span class="comment">//VFBD</span></span><br><span class="line"> .hsync_len = <span class="number">20</span>, <span class="comment">//HSPW</span></span><br><span class="line"> .vsync_len = <span class="number">3</span>, <span class="comment">//VSPW</span></span><br><span class="line"> .sync = <span class="number">0</span>,</span><br><span class="line"> .vmode = FB_VMODE_NONINTERLACED</span><br><span class="line">&#125; &#125; &#125;;</span><br></pre></td></tr></table></figure></li><li><p>使用示例代码中的屏幕参数替换掉 <code>mx6ull_alientek_emmc.c</code> 中 uboot 默认的屏幕参数。</p></li><li><p>打开 <code>mx6ull_alientek_emmc.h</code>，找到所有如下语句：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">panel=TFT43AB</span><br></pre></td></tr></table></figure></li><li><p>将其改为：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">panel=TFT7016</span><br></pre></td></tr></table></figure></li><li><p>也就是设置 panel 为 TFT7016，panel 的值要与示例代码中的<code>.name</code> 成员变量的值一致。修改完成以后重新编译一遍 uboot 并烧写到 SD 中启动。重启以后 LCD 驱动一般就会工作正常了，LCD 上回显示 NXP 的 logo。但是有可能会遇到 LCD 并没有工作，还是黑屏，这是什么原因呢？在 uboot 命令模式输入“print”来查看环境变量 panel 的值，会发现 panel 的值要是 TFT43AB(或其他的，反正不是 TFT7016)，如图所示：</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://tuchuang.voooe.cn/images/2023/03/28/I.MX6ULinuxV1.8-4.webp" alt=""></p></li><li><p>这是因为之前有将环境变量保存到 EMMC 中，uboot 启动以后会先从 EMMC 中读取环境变量，如果 EMMC 中没有环境变量的话才会使用 <code>mx6ull_alientek_emmc.h</code> 中的默认环境变量。如果 EMMC 中的环境变量 panel 不等于 TFT7016，那么 LCD 显示肯定不正常，我们只需要在 uboot 中修改 panel 的值为 TFT7016 即可，在 uboot 的命令模式下输入如下命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setenv panel TFT7016</span><br><span class="line">saveenv</span><br></pre></td></tr></table></figure></li><li><p>上述命令修改环境变量 panel 为 TFT7016，然后保存，重启 uboot，此时 LCD 驱动就工作正常了。如果 LCD 还是没有正常工作的，那就要检查自己哪里有没有改错，或者还有哪里没有修改。</p></li></ul><h3 id="2-7-底板网络驱动修改">2.7 底板网络驱动修改</h3><div class="note info flat"><p>V2.4 及以后版本的底板网络芯片更换为 SR8201F，并且网络 PHY 地址也有改变</p></div><ol><li><p>I.MX6U-ALPHA 开发板网络简介</p><ul><li><p>I.MX6UL/ULL 内部有个以太网 MAC 外设，也就是 ENET，需要外接一个 PHY 芯片来实现网络通信功能，也就是<strong>内部 MAC+外部 PHY 芯片</strong>的方案。大家可能听过 DM9000 这个网络芯片，在一些没有内部 MAC 的 CPU 中，比如三星的 2440，4412 等，就会采用 DM9000 来实现联网功能。DM9000 提供了一个类似 SRAM 的访问接口，主控 CPU 通过这个接口即可与 DM9000 进行通信，DM9000 就是一个 MAC+PHY 芯片。这个方案就相当于外部 MAC+外部 PHY，那么 I.MX6U 这样的内部 MAC+PHY 芯片与 DM9000 方案比有什么优势吗？那优势大了去了！首先就是通信效率和速度，一般 SOC 内部的 MAC 是带有一个专用 DMA (Direct Memory Access) 的，专门用于处理网络数据包，采用 SRAM 来读写 DM9000 的速度是压根就没法和内部 MAC+外部 PHY 芯片的速度比。采用外部 DM9000 完全是无奈之举，谁让 2440，4412 这些芯片内部没有以太网外设呢，现在又想用有线网络，没有办法只能找个 DM9000 的方案。从这里也可以看出，三星的 2440、4412 这些芯片设计之初就不是给工业产品用的，他们是给消费类电子使用的，比如手机、平板等，手机或平板要上网，可以通过 WIFI 或者 4G，我是没有见过哪个手机或者平板上网是要接根网线的。正点原子的 I.MX6U-ALPHA 开发板也可以通过 WIFI 或者 4G 上网，这个是后话了。</p></li><li><p>I.MX6UL/ULL 有两个网络接口 ENET1 和 ENET2，正点原子的 I.MX6U-ALPHA 开发板提供了这两个网络接口，其中 ENET1 和 ENET2 都使用 SR8201F 作为 PHY 芯片。NXP 官方的 I.MX6ULL EVK 开发板使用 KSZ8081 这颗 PHY 芯片，SR8201F 相比 KSZ8081 具有体积小、外围器件少、价格便宜等优点。直接使用 KSZ8081 固然可以，但是我们在实际的产品中不一定会使用 KSZ8081，有时候为了降低成本会选择其他的 PHY 芯片，这个时候就有个问题：换了 PHY 芯片以后网络驱动怎么办？为此，正点原子的 I.MX6U-ALPHA 开发板将 ENET1 和 ENET2 的 PHY 换成了 SR8201F，这样就可以给大家讲解<strong>更换 PHY 芯片以后如何调整网络驱动，使网络工作正常</strong>。</p></li><li><p>ENET1 的网络 PHY 芯片为 SR8201F，通过 RMII 接口与 I.MX6ULL 相连，正点原子 I.MX6U-ALPHA 开发板的 ENET1 引脚与 NXP 官方的 I.MX6ULL EVK 开发板基本一样，唯独复位引脚不同。正点原子 I.MX6U-ALPHA 开发板的 ENET1 复位引脚 ENET1_RST 接到了 I.M6ULL 的 SNVS_TAMPER7 这个引脚上。 SR8201F 内部是有寄存器的，I.MX6ULL 会读取 SR8201F 内部寄存器来判断当前的物理链接状态、连接速度(10M 还是 100M)和双工状态(半双工还是全双工)。I.MX6ULL 通过 MDIO 接口来读取 PHY 芯片的内部寄存器，MDIO 接口有两个引脚，ENET_MDC 和 ENET_MDIO， ENET_MDC 提供时钟，ENET_MDIO 进行数据传输。一个 MDIO 接口可以管理 32 个 PHY 芯片，同一个 MDIO 接口下的这些 PHY 使用不同的器件地址来做区分，MIDO 接口通过不同的器件地址即可访问到相应的 PHY 芯片。I.MX6U-ALPHA 开发板 ENET1 上连接的 SR8201F 器件地址为 0X2，所示我们要修改 ENET1 网络驱动的话重点就三点：</p></li></ul><ol><li>ENET1 复位引脚初始化。</li><li>SR8201F 的器件 ID。</li><li>SR8201F 驱动</li></ol><ul><li>关于 ENET2 网络驱动的修改也注意一下三点：</li></ul><ol><li>ENET2 的复位引脚，ENET2 的复位引脚 ENET2_RST 接到了 I.MX6ULL 的 SNVS_TAMPER8 上。</li><li>ENET2 所使用的 PHY 芯片器件地址，PHY 器件地址为 0X1。</li><li>SR8201F 驱动，ENET1 和 ENET2 都使用的 SR8201F，所以驱动肯定是一样的。</li></ol></li><li><p>网络 PHY 地址修改</p><ul><li><p>首先修改 uboot 中的 ENET1 和 ENET2 的 PHY 地址和驱动，打开 <code>mx6ull_alientek_emmc.h</code> 这个文件，找到如下代码：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifdef</span> CONFIG_CMD_NET</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CONFIG_CMD_PING</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CONFIG_CMD_DHCP</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CONFIG_CMD_MII</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CONFIG_FEC_MXC</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CONFIG_MII</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CONFIG_FEC_ENET_DEV 1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> (CONFIG_FEC_ENET_DEV == 0)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IMX_FEC_BASE ENET_BASE_ADDR</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CONFIG_FEC_MXC_PHYADDR     0x2</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CONFIG_FEC_XCV_TYPE         RMII</span></span><br><span class="line"><span class="meta">#<span class="keyword">elif</span> (CONFIG_FEC_ENET_DEV == 1)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IMX_FEC_BASE ENET2_BASE_ADDR</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CONFIG_FEC_MXC_PHYADDR 0x1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CONFIG_FEC_XCV_TYPE RMII</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CONFIG_ETHPRIME <span class="string">&quot;FEC&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CONFIG_PHYLIB</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CONFIG_PHY_MICREL</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure></li><li><p>第 7 行的宏 <code>CONFIG_FEC_ENET_DEV</code> 用于选择使用哪个网口，默认为 1，也就是选择 ENET2。第 11 行为 ENET1 的 PHY 地址，默认是 0X2，第 15 行为 ENET2 的 PHY 地址，默认为 0x1。根据前面的分析可知，正点原子的 I.MX6U-ALPHA 开发板 ENET1 的 PHY 地址刚好也为 0X2，ENET2 的 PHY 地址也是 0X1，所以可以直接使用默认配置，不需要我们修改。</p></li><li><p>第 21 行定了一个宏 <code>CONFIG_PHY_MICREL</code>，此宏用于使能 uboot 中 Micrel 公司的 PHY 驱动，KSZ8081 这颗 PHY 芯片就是 Micrel 公司生产的，不过 Micrel 已经被 Microchip 收购了。如果要使用 SR8201F，那么就得将 <code>CONFIG_PHY_MICREL</code> 改为 <code>CONFIG_PHY_REALTEK</code>。因为 SR8201F 就是 Pin to Pin 替换 Realtek 的 RTL8201F 的，因此可以直接使用 Realtek 的相关驱动。所以示例代码理论上有三处要修改：</p><ol><li>修改 ENET1 网络 PHY 的地址。</li><li>修改 ENET2 网络 PHY 的地址。</li><li>使能 REALTEK 公司的 PHY 驱动。</li></ol></li><li><p>但是，由于我们开发板上 SR8201F 的 PHY 地址和默认的配置一样，因此只需要是能 REALTEK 公司的 PHY 驱动，大家如果使用的其他品牌的开发板，那么就要根据实际情况来修改对应的 ENET1 和 ENET2 网络 PHY 地址。 修改后的网络 PHY 地址参数如下所示：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifdef</span> CONFIG_CMD_NET</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CONFIG_CMD_PING</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CONFIG_CMD_DHCP</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CONFIG_CMD_MII</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CONFIG_FEC_MXC</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CONFIG_MII</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CONFIG_FEC_ENET_DEV 1</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">if</span> (CONFIG_FEC_ENET_DEV == 0)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IMX_FEC_BASE ENET_BASE_ADDR</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CONFIG_FEC_MXC_PHYADDR      0x2</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CONFIG_FEC_XCV_TYPE         RMII</span></span><br><span class="line"><span class="meta">#<span class="keyword">elif</span> (CONFIG_FEC_ENET_DEV == 1)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IMX_FEC_BASE ENET2_BASE_ADDR</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CONFIG_FEC_MXC_PHYADDR     0x1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CONFIG_FEC_XCV_TYPE RMII</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CONFIG_ETHPRIME <span class="string">&quot;FEC&quot;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CONFIG_PHYLIB</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CONFIG_PHY_REALTEK</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>删除 uboot 中 74LV595 的驱动代码</p><ul><li><p>uboot 中网络 PHY 芯片地址修改完成以后就是网络复位引脚的驱动修改了，打开<code>mx6ull_alientek_emmc.c</code>，找到如下代码：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> IOX_SDI IMX_GPIO_NR(5, 10)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IOX_STCP  IMX_GPIO_NR(5, 7)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IOX_SHCP  IMX_GPIO_NR(5, 11)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IOX_OE IMX_GPIO_NR(5, 8)</span></span><br></pre></td></tr></table></figure></li><li><p>以 IOX 开头的宏定义是 74LV595 的相关 GPIO，因为 NXP 官方 I.MX6ULL EVK 开发板使用 74LV595 来扩展 IO，两个网络的复位引脚就是由 74LV595 来控制的。正点原子的 I.MX6U-ALPHA 开发板并没有使用 74LV595，因此我们将对应的代码删除掉，替换为如下所示代码：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> ENET1_RESET IMX_GPIO_NR(5, 7)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ENET2_RESET IMX_GPIO_NR(5, 8)</span></span><br></pre></td></tr></table></figure></li><li><p>ENET1 的复位引脚连接到 SNVS_TAMPER7 上，对应 GPIO5_IO07，ENET2 的复位引脚连接到 SNVS_TAMPER8 上，对应 GPIO5_IO08。继续在 <code>mx6ull_alientek_emmc.c</code> 中找到如下代码：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">iomux_v3_cfg_t</span> <span class="type">const</span> iox_pads[] = &#123;</span><br><span class="line">    <span class="comment">/* IOX_SDI */</span></span><br><span class="line">    MX6_PAD_BOOT_MODE0__GPIO5_IO10 | MUX_PAD_CTRL(NO_PAD_CTRL),</span><br><span class="line">    <span class="comment">/* IOX_SHCP */</span></span><br><span class="line">    MX6_PAD_BOOT_MODE1__GPIO5_IO11 | MUX_PAD_CTRL(NO_PAD_CTRL),</span><br><span class="line">    <span class="comment">/* IOX_STCP */</span></span><br><span class="line">    MX6_PAD_SNVS_TAMPER7__GPIO5_IO07 | MUX_PAD_CTRL(NO_PAD_CTRL),</span><br><span class="line">    <span class="comment">/* IOX_nOE */</span></span><br><span class="line">    MX6_PAD_SNVS_TAMPER8__GPIO5_IO08 | MUX_PAD_CTRL(NO_PAD_CTRL),</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li><li><p>同理，这是 74LV595 的 IO 配置参数结构体，将其删除掉（因为其用到这两个 IO 会冲突）。继续在 <code>mx6ull_alientek_emmc.c</code> 中找到函数 <code>iox74lv_init</code>，如下所示：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">iox74lv_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    gpio_direction_output(IOX_OE, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">7</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        gpio_direction_output(IOX_SHCP, <span class="number">0</span>);</span><br><span class="line">        gpio_direction_output(IOX_SDI, seq[qn_output[i]][<span class="number">0</span>]);</span><br><span class="line">        udelay(<span class="number">500</span>);</span><br><span class="line">        gpio_direction_output(IOX_SHCP, <span class="number">1</span>);</span><br><span class="line">        udelay(<span class="number">500</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ......</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * shift register will be output to pins</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    gpio_direction_output(IOX_STCP, <span class="number">1</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">iox74lv_set</span><span class="params">(<span class="type">int</span> index)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">7</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        gpio_direction_output(IOX_SHCP, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (i == index)</span><br><span class="line">            gpio_direction_output(IOX_SDI, seq[qn_output[i]][<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            gpio_direction_output(IOX_SDI, seq[qn_output[i]][<span class="number">1</span>]);</span><br><span class="line">        udelay(<span class="number">500</span>);</span><br><span class="line">        gpio_direction_output(IOX_SHCP, <span class="number">1</span>);</span><br><span class="line">        udelay(<span class="number">500</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ......</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">      * shift register will be output to pins</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">    gpio_direction_output(IOX_STCP, <span class="number">1</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li><li><p><code>iox74lv_init</code> 函数是 74LV595 的初始化函数，iox74lv_set 函数用于控制 74LV595 的 IO 输出电平，将这两个函数全部删除掉！ 在 <code>mx6ull_alientek_emmc.c</code> 中找到 <code>board_init</code> 函数，此函数是板子初始化函数，会被 <code>board_init_r</code> 调用，<code>board_init</code> 函数内容如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">board_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">......</span><br><span class="line">imx_iomux_v3_setup_multiple_pads(iox_pads, ARRAY_SIZE(iox_pads));</span><br><span class="line">    iox74lv_init();</span><br><span class="line">    ......</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>board_init</code> 会调用 <code>imx_iomux_v3_setup_multiple_pads</code> 和 <code>iox74lv_init</code> 这两个函数来初化 74lv595 的 GPIO，将这两行删除掉。至此，<code>mx6ull_alientek_emmc.c</code> 中关于 74LV595 芯片的驱动代码<strong>都删除掉</strong>了，接下来就是添加 I.MX6U-ALPHA 开发板两个网络复位引脚了。</p></li></ul></li><li><p>添加 I.MX6U-ALPHA 开发板网络复位引脚驱动</p><ul><li><p>在 <code>mx6ull_alientek_emmc.c</code> 中找到如下所示代码：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">iomux_v3_cfg_t</span> <span class="type">const</span> fec1_pads[] = &#123;</span><br><span class="line">    MX6_PAD_GPIO1_IO06__ENET1_MDIO | MUX_PAD_CTRL(MDIO_PAD_CTRL),</span><br><span class="line">    MX6_PAD_GPIO1_IO07__ENET1_MDC | MUX_PAD_CTRL(ENET_PAD_CTRL),</span><br><span class="line">    ...</span><br><span class="line">    MX6_PAD_ENET1_RX_ER__ENET1_RX_ER | MUX_PAD_CTRL(ENET_PAD_CTRL),</span><br><span class="line">    MX6_PAD_ENET1_RX_EN__ENET1_RX_EN | MUX_PAD_CTRL(ENET_PAD_CTRL),</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">iomux_v3_cfg_t</span> <span class="type">const</span> fec2_pads[] = &#123;</span><br><span class="line">    MX6_PAD_GPIO1_IO06__ENET2_MDIO | MUX_PAD_CTRL(MDIO_PAD_CTRL),</span><br><span class="line">    MX6_PAD_GPIO1_IO07__ENET2_MDC | MUX_PAD_CTRL(ENET_PAD_CTRL),</span><br><span class="line">    ...</span><br><span class="line">    MX6_PAD_ENET2_RX_EN__ENET2_RX_EN | MUX_PAD_CTRL(ENET_PAD_CTRL),</span><br><span class="line">    MX6_PAD_ENET2_RX_ER__ENET2_RX_ER | MUX_PAD_CTRL(ENET_PAD_CTRL),</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li><li><p>结构体数组 <code>fec1_pads</code> 和 <code>fec2_pads</code> 是 ENET1 和 ENET2 这两个网口的 <strong>IO 配置参数</strong>，在这两个数组中添加两个网口的复位 IO 配置参数，完成以后如下所示：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">iomux_v3_cfg_t</span> <span class="type">const</span> fec1_pads[] = &#123;</span><br><span class="line">    MX6_PAD_GPIO1_IO06__ENET1_MDIO | MUX_PAD_CTRL(MDIO_PAD_CTRL),</span><br><span class="line">    MX6_PAD_GPIO1_IO07__ENET1_MDC | MUX_PAD_CTRL(ENET_PAD_CTRL),</span><br><span class="line">..</span><br><span class="line">    MX6_PAD_ENET1_RX_ER__ENET1_RX_ER | MUX_PAD_CTRL(ENET_PAD_CTRL),</span><br><span class="line">    MX6_PAD_ENET1_RX_EN__ENET1_RX_EN | MUX_PAD_CTRL(ENET_PAD_CTRL),</span><br><span class="line">    MX6_PAD_SNVS_TAMPER7__GPIO5_IO07 | MUX_PAD_CTRL(NO_PAD_CTRL),</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">iomux_v3_cfg_t</span> <span class="type">const</span> fec2_pads[] = &#123;</span><br><span class="line">    MX6_PAD_GPIO1_IO06__ENET2_MDIO | MUX_PAD_CTRL(MDIO_PAD_CTRL),</span><br><span class="line">    MX6_PAD_GPIO1_IO07__ENET2_MDC | MUX_PAD_CTRL(ENET_PAD_CTRL),</span><br><span class="line">..</span><br><span class="line">    MX6_PAD_ENET2_RX_EN__ENET2_RX_EN | MUX_PAD_CTRL(ENET_PAD_CTRL),</span><br><span class="line">    MX6_PAD_ENET2_RX_ER__ENET2_RX_ER | MUX_PAD_CTRL(ENET_PAD_CTRL),</span><br><span class="line">    MX6_PAD_SNVS_TAMPER8__GPIO5_IO08 | MUX_PAD_CTRL(NO_PAD_CTRL),</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li><li><p>第 7 行和 16 行分别是 ENET1 和 ENET2 的复位 IO 配置参数。继续在文件 <code>mx6ull_alientek_emmc.c</code> 中找到函数 <code>setup_iomux_fec</code>，此函数默认代码如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">setup_iomux_fec</span><span class="params">(<span class="type">int</span> fec_id)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (fec_id == <span class="number">0</span>)</span><br><span class="line">        imx_iomux_v3_setup_multiple_pads(fec1_pads,</span><br><span class="line">                         ARRAY_SIZE(fec1_pads));</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        imx_iomux_v3_setup_multiple_pads(fec2_pads,</span><br><span class="line">                         ARRAY_SIZE(fec2_pads));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>函数 <code>setup_iomux_fec</code> 就是根据 <code>fec1_pads</code> 和 <code>fec2_pads</code> 这两个网络 IO 配置数组来初始化 I.MX6ULL 的网络 IO。我们需要在其中添加网络复位 IO 的初始化代码，并且复位一下 PHY 芯片，修改后的 <code>setup_iomux_fec</code> 函数如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">setup_iomux_fec</span><span class="params">(<span class="type">int</span> fec_id)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (fec_id == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        imx_iomux_v3_setup_multiple_pads(fec1_pads,</span><br><span class="line">                         ARRAY_SIZE(fec1_pads));</span><br><span class="line"></span><br><span class="line">        gpio_direction_output(ENET1_RESET, <span class="number">1</span>);</span><br><span class="line">        gpio_set_value(ENET1_RESET, <span class="number">0</span>);</span><br><span class="line">        mdelay(<span class="number">20</span>);</span><br><span class="line">        gpio_set_value(ENET1_RESET, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        imx_iomux_v3_setup_multiple_pads(fec2_pads,</span><br><span class="line">                         ARRAY_SIZE(fec2_pads));</span><br><span class="line">        gpio_direction_output(ENET2_RESET, <span class="number">1</span>);</span><br><span class="line">        gpio_set_value(ENET2_RESET, <span class="number">0</span>);</span><br><span class="line">        mdelay(<span class="number">20</span>);</span><br><span class="line">        gpio_set_value(ENET2_RESET, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">   mdelay(<span class="number">150</span>); <span class="comment">/* 复位结束后至少延时150ms才能正常使用*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>示例代码中第 9 行 ~ 12 行和第 18 行~ 21 行分别对应 ENET1 和 ENET2 的复位 IO 初始化，将这两个 IO 设置为输出并且硬件复位一下 LAN8720A，这个硬件复位很重要！第 22 行复位结束以后一定要至少延时 150ms 才能操作 SR8201F，这个在 SR8201F 数据手册里面有详细要求的，否则会导致 uboot 无法识别 SR8201F。</p></li><li><p>至此网络的复位引脚驱动修改完成，重新编译 uboot，然后将 <code>u-boot.bin</code> 烧写到 SD 卡中并启动，uboot 启动信息如图所示：</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://tuchuang.voooe.cn/images/2023/03/29/I.MX6ULinuxV1.8ba935c053cf3b280.webp" alt=""></p></li><li><p>可以看到“Net:FEC1”这一行，提示当前使用的 FEC1 这个网口，也就是 ENET2。在 uboot 中使用网络之前要先设置几个环境变量，命令如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">setenv ipaddr 192.168.1.55 //开发板 IP 地址</span><br><span class="line">setenv ethaddr b8:ae:1d:01:00:00 //开发板网卡 MAC 地址</span><br><span class="line">setenv gatewayip 192.168.1.1 //开发板默认网关</span><br><span class="line">setenv netmask 255.255.255.0 //开发板子网掩码</span><br><span class="line">setenv serverip 192.168.1.250 //服务器地址，也就是 Ubuntu 地址</span><br><span class="line">saveenv //保存环境变量</span><br></pre></td></tr></table></figure></li><li><p>设置好环境变量以后就可以在 uboot 中使用网络了，用网线将 I.MX6U-ALPHA 上的 ENET2 与电脑或者路由器连接起来，保证开发板和电脑在同一个网段内，通过 ping 命令来测试一下网络连接，命令如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping 192.168.1.250</span><br></pre></td></tr></table></figure></li><li><p>结果如图：</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://tuchuang.voooe.cn/images/2023/03/29/2db035447d32f61b48ba5ccf307cd97c.webp" alt=""></p></li><li><p>有“host 192.168.1.250 is alive”这句，说明 ping 主机成功，说明 ENET2 网络工作正常。再来测试一下 ENET1 的网络是否正常工作，打开<code>mx6ull_alientek_emmc.h</code>，将 <code>CONFIG_FEC_ENET_DEV</code> 改为 0，然后重新编译一下 uboot 并烧写到 SD 卡中重启。重启开发板，uboot 输出信息如图 33.2.8.5 所示：</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://tuchuang.voooe.cn/images/2023/03/29/aa.webp" alt=""></p></li><li><p>有“Net：FEC0”这一行，说明当前使用的 FEC0 这个网卡，也就是 ENET1，同样的 ping 一下主机，结果如图 33.2.8.6 所示：</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdnjson.com/images/2023/03/29/bb.webp" alt=""></p></li><li><p>ping 主机也成功，说明 ENET1 网络也工作正常，至此，I.MX6U-ALPHA 开发板的两个网络都工作正常了，建议大家将 ENET2 设置为 uboot 的默认网卡！也就是将宏 <code>CONFIG_FEC_ENET_DEV</code> 设置为 1 。</p></li></ul><h3 id="2-8-其他需要修改的地方">2.8 其他需要修改的地方</h3><ul><li><p>在 uboot 启动信息中会有“Board: MX6ULL 14x14 EVK”这一句，也就是说板子名字为“MX6ULL 14x14 EVK”，要将其改为我们所使用的板子名字，比如“MX6ULL ALIENTEK EMMC”或者“MX6ULL ALIENTEK NAND”。打开文件 <code>mx6ull_alientek_emmc.c</code>，找到函数<code>checkboard</code>，将其改为如下所示内容：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">checkboard</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (is_mx6ull_9x9_evk())</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Board: MX6ULL 9x9 EVK\n&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Board: MX6ULL ALIENTEK EMMC\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>修改完成以后重新编译 uboot 并烧写到 SD 卡中验证，uboot 启动信息如图所示：</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdnjson.com/images/2023/03/29/pic1.webp" alt=""></p></li><li><p>Board 变成了“MX6ULL ALIENTEK EMMC”。至此 uboot 的驱动部分就修改完成了，uboot 移植也完成了，uboot 的最终目的就是<strong>启动 Linux 内核</strong>，所以需要通过启动 Linux 内核来判断 uboot 移植是否成功。在启动 Linux 内核之前我们先来学习两个重要的环境变量 <code>bootcmd</code> 和 <code>bootargs</code>。</p></li></ul></li></ol><h2 id="3-bootcmd-和-bootargs-环境变量">3.bootcmd 和 bootargs 环境变量</h2><ul><li><p>uboot 中有两个非常重要的环境变量 <code>bootcmd</code> 和 <code>bootargs</code>，接下来看一下这两个环境变量。<code>bootcmd</code> 和 <code>bootagrs</code> 是采用类似 shell 脚本语言编写的，里面有很多的变量引用，这些变量其实都是环境变量，有很多是 NXP 自己定义的。文件 <code>mx6ull_alientek_emmc.h</code> 中的宏 <code>CONFIG_EXTRA_ENV_SETTINGS</code> 保存着这些环境变量的默认值，内容如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">if</span> defined(CONFIG_SYS_BOOT_NAND)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CONFIG_EXTRA_ENV_SETTINGS \</span></span><br><span class="line"><span class="meta">    CONFIG_MFG_ENV_SETTINGS \</span></span><br><span class="line"><span class="meta">    <span class="string">&quot;panel=TFT43AB\0&quot;</span> \</span></span><br><span class="line"><span class="meta">    <span class="string">&quot;fdt_addr=0x83000000\0&quot;</span> \</span></span><br><span class="line"><span class="meta">    <span class="string">&quot;fdt_high=0xffffffff\0&quot;</span>   \</span></span><br><span class="line"><span class="meta">..</span></span><br><span class="line">        <span class="string">&quot;bootz $&#123;loadaddr&#125; - $&#123;fdt_addr&#125;\0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CONFIG_EXTRA_ENV_SETTINGS \</span></span><br><span class="line"><span class="meta">    CONFIG_MFG_ENV_SETTINGS \</span></span><br><span class="line"><span class="meta">    <span class="string">&quot;script=boot.scr\0&quot;</span> \</span></span><br><span class="line"><span class="meta">    <span class="string">&quot;image=zImage\0&quot;</span> \</span></span><br><span class="line"><span class="meta">    <span class="string">&quot;console=ttymxc0\0&quot;</span> \</span></span><br><span class="line"><span class="meta">    <span class="string">&quot;fdt_high=0xffffffff\0&quot;</span> \</span></span><br><span class="line"><span class="meta">    <span class="string">&quot;initrd_high=0xffffffff\0&quot;</span> \</span></span><br><span class="line"><span class="meta">..</span></span><br><span class="line">     <span class="string">&quot;findfdt=&quot;</span>\</span><br><span class="line">       <span class="string">&quot;if test $fdt_file = undefined; then &quot;</span> \</span><br><span class="line">        <span class="string">&quot;if test $board_name = EVK &amp;&amp; test $board_rev = 9X9; then &quot;</span> \</span><br><span class="line">         <span class="string">&quot;setenv fdt_file imx6ull-9x9-evk.dtb; fi; &quot;</span> \</span><br><span class="line">     <span class="string">&quot;if test $board_name = EVK &amp;&amp; test $board_rev = 14X14; then &quot;</span> \</span><br><span class="line">                    <span class="string">&quot;setenv fdt_file imx6ull-14x14-evk.dtb; fi; &quot;</span> \</span><br><span class="line">            <span class="string">&quot;if test $fdt_file = undefined; then &quot;</span> \</span><br><span class="line">            <span class="string">&quot;echo WARNING: Could not determine dtb to use; fi; &quot;</span> \</span><br><span class="line">            <span class="string">&quot;fi;\0&quot;</span> \</span><br></pre></td></tr></table></figure></li><li><p>宏 <code>CONFIG_EXTRA_ENV_SETTINGS</code> 是个条件编译语句，使用 NAND 和 EMMC 的时候宏 <code>CONFIG_EXTRA_ENV_SETTINGS</code> 的值是不同的。</p></li></ul><h3 id="3-1-环境变量-bootcmd">3.1 环境变量 bootcmd</h3><ul><li><p><code>bootcmd</code> 在前面已经说了很多次了，bootcmd 保存着 uboot 默认命令，uboot 倒计时结束以后就会执行 bootcmd 中的命令。这些命令一般都是用来启动 Linux 内核的，比如读取 EMMC 或者 NAND Flash 中的 Linux 内核镜像文件和设备树文件到 DRAM 中，然后启动 Linux 内核。可以在 uboot 启动以后进入命令行设置 <code>bootcmd</code> 环境变量的值。如果 EMMC 或者 NAND 中没有保存 bootcmd 的值，那么 uboot 就会使用默认的值，板子第一次运行 uboot 的时候都会使用默认值来设置 <code>bootcmd</code> 环境变量。打开文件 <code>include/env_default.h</code>，在此文件中有如下所示内容：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifdef</span> DEFAULT_ENV_INSTANCE_EMBEDDED</span></span><br><span class="line"> <span class="type">env_t</span> environment __PPCENV__ = &#123;</span><br><span class="line">     ENV_CRC,    <span class="comment">/* CRC Sum */</span></span><br><span class="line"> <span class="meta">#<span class="keyword">ifdef</span> CONFIG_SYS_REDUNDAND_ENVIRONMENT</span></span><br><span class="line">     <span class="number">1</span>,      <span class="comment">/* Flags: valid */</span></span><br><span class="line"> <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">     &#123;</span><br><span class="line"> <span class="meta">#<span class="keyword">elif</span> defined(DEFAULT_ENV_INSTANCE_STATIC)</span></span><br><span class="line"> <span class="type">static</span> <span class="type">char</span> default_environment[] = &#123;</span><br><span class="line"> <span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"> <span class="type">const</span> uchar default_environment[] = &#123;</span><br><span class="line"> <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"> <span class="meta">#<span class="keyword">ifdef</span>  CONFIG_ENV_CALLBACK_LIST_DEFAULT</span></span><br><span class="line">     ENV_CALLBACK_VAR <span class="string">&quot;=&quot;</span> CONFIG_ENV_CALLBACK_LIST_DEFAULT <span class="string">&quot;\0&quot;</span></span><br><span class="line"> <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"> <span class="meta">#<span class="keyword">ifdef</span>  CONFIG_ENV_FLAGS_LIST_DEFAULT</span></span><br><span class="line">     ENV_FLAGS_VAR <span class="string">&quot;=&quot;</span> CONFIG_ENV_FLAGS_LIST_DEFAULT <span class="string">&quot;\0&quot;</span></span><br><span class="line"> <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"> <span class="meta">#<span class="keyword">ifdef</span>  CONFIG_BOOTARGS</span></span><br><span class="line">     <span class="string">&quot;bootargs=&quot;</span> CONFIG_BOOTARGS         <span class="string">&quot;\0&quot;</span></span><br><span class="line"> <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span>  CONFIG_BOOTCOMMAND</span></span><br><span class="line">    <span class="string">&quot;bootcmd=&quot;</span>  CONFIG_BOOTCOMMAND      <span class="string">&quot;\0&quot;</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span>  CONFIG_RAMBOOTCOMMAND</span></span><br><span class="line">    <span class="string">&quot;ramboot=&quot;</span>  CONFIG_RAMBOOTCOMMAND       <span class="string">&quot;\0&quot;</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span>  CONFIG_NFSBOOTCOMMAND</span></span><br><span class="line">    <span class="string">&quot;nfsboot=&quot;</span>  CONFIG_NFSBOOTCOMMAND       <span class="string">&quot;\0&quot;</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(CONFIG_BOOTDELAY) &amp;&amp; (CONFIG_BOOTDELAY &gt;= 0)</span></span><br><span class="line">    <span class="string">&quot;bootdelay=&quot;</span>    __stringify(CONFIG_BOOTDELAY)   <span class="string">&quot;\0&quot;</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(CONFIG_BAUDRATE) &amp;&amp; (CONFIG_BAUDRATE &gt;= 0)</span></span><br><span class="line">    <span class="string">&quot;baudrate=&quot;</span> __stringify(CONFIG_BAUDRATE)    <span class="string">&quot;\0&quot;</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span>  CONFIG_LOADS_ECHO</span></span><br><span class="line">    <span class="string">&quot;loads_echo=&quot;</span>   __stringify(CONFIG_LOADS_ECHO)  <span class="string">&quot;\0&quot;</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span>  CONFIG_ETHPRIME</span></span><br><span class="line">    <span class="string">&quot;ethprime=&quot;</span> CONFIG_ETHPRIME         <span class="string">&quot;\0&quot;</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span>  CONFIG_IPADDR</span></span><br><span class="line">    <span class="string">&quot;ipaddr=&quot;</span>   __stringify(CONFIG_IPADDR)  <span class="string">&quot;\0&quot;</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span>  CONFIG_SERVERIP</span></span><br><span class="line">    <span class="string">&quot;serverip=&quot;</span> __stringify(CONFIG_SERVERIP)    <span class="string">&quot;\0&quot;</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span>  CONFIG_SYS_AUTOLOAD</span></span><br><span class="line">    <span class="string">&quot;autoload=&quot;</span> CONFIG_SYS_AUTOLOAD     <span class="string">&quot;\0&quot;</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span>  CONFIG_PREBOOT</span></span><br><span class="line">    <span class="string">&quot;preboot=&quot;</span>  CONFIG_PREBOOT          <span class="string">&quot;\0&quot;</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span>  CONFIG_ROOTPATH</span></span><br><span class="line">    <span class="string">&quot;rootpath=&quot;</span> CONFIG_ROOTPATH         <span class="string">&quot;\0&quot;</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span>  CONFIG_GATEWAYIP</span></span><br><span class="line">    <span class="string">&quot;gatewayip=&quot;</span>    __stringify(CONFIG_GATEWAYIP)   <span class="string">&quot;\0&quot;</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span>  CONFIG_NETMASK</span></span><br><span class="line">    <span class="string">&quot;netmask=&quot;</span>  __stringify(CONFIG_NETMASK) <span class="string">&quot;\0&quot;</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span>  CONFIG_HOSTNAME</span></span><br><span class="line">    <span class="string">&quot;hostname=&quot;</span> __stringify(CONFIG_HOSTNAME)    <span class="string">&quot;\0&quot;</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span>  CONFIG_BOOTFILE</span></span><br><span class="line">    <span class="string">&quot;bootfile=&quot;</span> CONFIG_BOOTFILE         <span class="string">&quot;\0&quot;</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span>  CONFIG_LOADADDR</span></span><br><span class="line">    <span class="string">&quot;loadaddr=&quot;</span> __stringify(CONFIG_LOADADDR)    <span class="string">&quot;\0&quot;</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span>  CONFIG_CLOCKS_IN_MHZ</span></span><br><span class="line">    <span class="string">&quot;clocks_in_mhz=1\0&quot;</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(CONFIG_PCI_BOOTDELAY) &amp;&amp; (CONFIG_PCI_BOOTDELAY &gt; 0)</span></span><br><span class="line">    <span class="string">&quot;pcidelay=&quot;</span> __stringify(CONFIG_PCI_BOOTDELAY)<span class="string">&quot;\0&quot;</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span>  CONFIG_ENV_VARS_UBOOT_CONFIG</span></span><br><span class="line">    <span class="string">&quot;arch=&quot;</span>     CONFIG_SYS_ARCH         <span class="string">&quot;\0&quot;</span></span><br><span class="line">    <span class="string">&quot;cpu=&quot;</span>      CONFIG_SYS_CPU          <span class="string">&quot;\0&quot;</span></span><br><span class="line">    <span class="string">&quot;board=&quot;</span>    CONFIG_SYS_BOARD        <span class="string">&quot;\0&quot;</span></span><br><span class="line">    <span class="string">&quot;board_name=&quot;</span>   CONFIG_SYS_BOARD        <span class="string">&quot;\0&quot;</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> CONFIG_SYS_VENDOR</span></span><br><span class="line">    <span class="string">&quot;vendor=&quot;</span>   CONFIG_SYS_VENDOR       <span class="string">&quot;\0&quot;</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> CONFIG_SYS_SOC</span></span><br><span class="line">    <span class="string">&quot;soc=&quot;</span>      CONFIG_SYS_SOC          <span class="string">&quot;\0&quot;</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span>  CONFIG_EXTRA_ENV_SETTINGS</span></span><br><span class="line">    CONFIG_EXTRA_ENV_SETTINGS</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    <span class="string">&quot;\0&quot;</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> DEFAULT_ENV_INSTANCE_EMBEDDED</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li><li><p>第 13~23 行 ， 这 段 代 码 是 个 条 件 编 译 ， 由 于 没 有 定 义<code>DEFAULT_ENV_INSTANCE_EMBEDDED</code> 和<code>CONFIG_SYS_REDUNDAND_ENVIRONMENT</code>，因此 <code>uchar default_environment[]</code>数组保存环境变量。 在示例代码中指定了很多环境变量的默认值，比如 bootcmd 的默认值就是 <code>CONFIG_BOOTCOMMAND</code> ，<code>bootargs</code> 的默认值就是 <code>CONFIG_BOOTARGS</code>。我们可以在<code>mx6ull_alientek_emmc.h</code> 文件中通过设置宏 <code>CONFIG_BOOTCOMMAND</code> 来设置 bootcmd 的默认值，NXP 官方设置的 CONFIG_BOOTCOMMAND 值如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> CONFIG_BOOTCOMMAND \</span></span><br><span class="line"><span class="meta">       <span class="string">&quot;run findfdt;&quot;</span> \</span></span><br><span class="line"><span class="meta">       <span class="string">&quot;mmc dev $&#123;mmcdev&#125;;&quot;</span> \</span></span><br><span class="line"><span class="meta">       <span class="string">&quot;mmc dev $&#123;mmcdev&#125;; if mmc rescan; then &quot;</span> \</span></span><br><span class="line"><span class="meta">           <span class="string">&quot;if run loadbootscript; then &quot;</span> \</span></span><br><span class="line"><span class="meta">               <span class="string">&quot;run bootscript; &quot;</span> \</span></span><br><span class="line"><span class="meta">           <span class="string">&quot;else &quot;</span> \</span></span><br><span class="line"><span class="meta">               <span class="string">&quot;if run loadimage; then &quot;</span> \</span></span><br><span class="line"><span class="meta">                   <span class="string">&quot;run mmcboot; &quot;</span> \</span></span><br><span class="line"><span class="meta">               <span class="string">&quot;else run netboot; &quot;</span> \</span></span><br><span class="line"><span class="meta">               <span class="string">&quot;fi; &quot;</span> \</span></span><br><span class="line"><span class="meta">           <span class="string">&quot;fi; &quot;</span> \</span></span><br><span class="line"><span class="meta">       <span class="string">&quot;else run netboot; fi&quot;</span></span></span><br></pre></td></tr></table></figure></li><li><p>看起来很复杂的样子！因为 uboot 使用了类似 shell 脚本语言的方式来编写的，我们一行一行来分析。 第 2 行，<code>run findfdt</code>；使用的是 uboot 的 run 命令来运行 <code>findfdt</code>，<code>findfdt</code> 是 NXP 自行添加的环境变量，是用来查找开发板对应的设备树文件(.dtb)。IMX6ULL EVK 的设备树文件为 <code>imx6ull-14x14-evk.dtb</code>，findfdt 内容如下：</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;findfdt=&quot;</span>\</span><br><span class="line"><span class="string">&quot;if test $fdt_file = undefined; then &quot;</span> \</span><br><span class="line"><span class="string">&quot;if test $board_name = EVK &amp;&amp; test $board_rev = 9X9; then &quot;</span> \</span><br><span class="line"> <span class="string">&quot;setenv fdt_file imx6ull-9x9-evk.dtb; fi; &quot;</span> \</span><br><span class="line"> <span class="string">&quot;if test $board_name = EVK &amp;&amp; test $board_rev = 14X14; then &quot;</span> \</span><br><span class="line"> <span class="string">&quot;setenv fdt_file imx6ull-14x14-evk.dtb; fi; &quot;</span> \</span><br><span class="line"> <span class="string">&quot;if test $fdt_file = undefined; then &quot;</span> \</span><br><span class="line"> <span class="string">&quot;echo WARNING: Could not determine dtb to use; fi; &quot;</span> \</span><br><span class="line"><span class="string">&quot;fi;\0&quot;</span> \</span><br></pre></td></tr></table></figure></li><li><p>findfdt 里面用到的变量有<code>fdt_file</code>，<code>board_name</code>，<code>board_rev</code>，这三个变量内容如下：</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fdt_file=undefined，board_name=EVK，board_rev=14X14</span><br></pre></td></tr></table></figure></li><li><p>findfdt 做的事情就是判断，<code>fdt_file</code> 是否为 undefined，如果 <code>fdt_file</code> 为 undefined 的话那要根据板子信息得出所需的.dtb 文件名。此时 fdt_file 为 undefined，所以根据 <code>board_name</code> 和<code>board_rev</code> 来判断实际所需的.dtb 文件，如果 <code>board_name</code> 为 EVK 并且<code>board_rev=9x9</code> 的话 fdt_file 就为 <code>imx6ull-9x9-evk.dtb</code>。如果 board_name 为 EVK 并且 board_rev=14x14 的话 fdt_file 设置为 <code>imx6ull-14x14-evk.dtb</code>。因此 IMX6ULL EVK 板子的设备树文件就是 <code>imx6ull-14x14-evk.dtb</code>，因此<code>run findfdt</code> 的结果就是设置 fdt_file 为 <code>imx6ull-14x14-evk.dtb</code>。 第 3 行，<code>mmc dev $&#123;mmcdev&#125;</code>用于切换 mmc 设备，mmcdev 为 1，因此这行代码就是：mmc dev 1，也就是切换到 EMMC 上。</p></li><li><p>第 4 行，先执行 <code>mmc dev $&#123;mmcdev&#125;</code> 切换到 EMMC 上，然后使用命令 <code>mmc rescan</code> 扫描看有没有 SD 卡或者 EMMC 存在，如果没有的话就直接跳到 13 行，执行 <code>run netboot</code>，netboot 也是一个自定义的环境变量，这个变量是从网络启动 Linux 的。如果 mmc 设备存在的话就从 mmc 设备启动。 第 5 行，运行<code>loadbootscript</code> 环境变量，此环境变量内容如下：</p></li><li><p>第 5 行，运行 <code>loadbootscript</code> 环境变量，此环境变量内容如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loadbootscript=fatload mmc $&#123;mmcdev&#125;:$&#123;mmcpart&#125; $&#123;loadaddr&#125; $&#123;script&#125;;</span><br></pre></td></tr></table></figure></li><li><p>其中 mmcdev=1，mmcpart=1，loadaddr=0x80800000，script= boot.scr，因此展开以后就是：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loadbootscript=fatload mmc 1:1 0x80800000 boot.scr;</span><br></pre></td></tr></table></figure></li><li><p><code>loadbootscript</code> 就是从 mmc1 的分区 1 中读取文件 <code>boot.src</code> 到 DRAM 的 0X80800000 处。但是 mmc1 的分区 1 中没有 boot.src 这个文件，可以使用命令“ls mmc 1:1”查看一下 mmc1 分区 1 中的所有文件，看看有没有 <code>boot.src</code> 这个文件。 第 6 行，如果加载 <code>boot.src</code> 文件成功的话就运行 <code>bootscript</code> 环境变量，<code>bootscript</code> 的内容如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bootscript=echo Running bootscript from mmc ...;</span><br><span class="line">source</span><br></pre></td></tr></table></figure></li><li><p>因为 <code>boot.src</code> 文件不存在，所以 <code>bootscript</code> 也就不会运行。 第 8 行，如果 <code>loadbootscript</code> 没有找到 <code>boot.src</code> 的话就运行环境变量 <code>loadimage</code>，环境变量 <code>loadimage</code> 内容如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loadimage=fatload mmc $&#123;mmcdev&#125;:$&#123;mmcpart&#125; $&#123;loadaddr&#125; $&#123;image&#125;</span><br></pre></td></tr></table></figure></li><li><p>其中 mmcdev=1，mmcpart=1，loadaddr=0x80800000，image = zImage，展开以后就是：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loadimage=fatload mmc 1:1 0x80800000 zImage</span><br></pre></td></tr></table></figure></li><li><p>可以看出 <code>loadimage</code> 就是从 mmc1 的分区中读取 <code>zImage</code> 到内存的 0X80800000 处，而 mmc1 的分区 1 中存在 zImage。 第 9 行，加载 linux 镜像文件 zImage 成功以后就运行环境变量 <code>mmcboot</code>，否则的话运行 <code>netboot</code> 环境变量。<code>mmcboot</code> 环境变量如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&quot;mmcboot=echo Booting from mmc ...; &quot; \</span><br><span class="line">    &quot;run mmcargs; &quot; \</span><br><span class="line">    &quot;if test $&#123;boot_fdt&#125; = yes || test $&#123;boot_fdt&#125; = try; then &quot; \</span><br><span class="line">        &quot;if run loadfdt; then &quot; \</span><br><span class="line">            &quot;bootz $&#123;loadaddr&#125; - $&#123;fdt_addr&#125;; &quot; \</span><br><span class="line">        &quot;else &quot; \</span><br><span class="line">            &quot;if test $&#123;boot_fdt&#125; = try; then &quot; \</span><br><span class="line">                &quot;bootz; &quot; \</span><br><span class="line">            &quot;else &quot; \</span><br><span class="line">                &quot;echo WARN: Cannot load the DT; &quot; \</span><br><span class="line">            &quot;fi; &quot; \</span><br><span class="line">        &quot;fi; &quot; \</span><br><span class="line">    &quot;else &quot; \</span><br><span class="line">        &quot;bootz; &quot; \</span><br><span class="line">    &quot;fi;\0&quot; \</span><br></pre></td></tr></table></figure></li><li><p>第 1 行，输出信息“Booting from mmc …”。 第 2 行，运行环境变量 <code>mmcargs</code>，<code>mmcargs</code> 用来设置 <code>bootargs</code>，后面分析 <code>bootargs</code> 的时候在学习。 第 3 行，判断 <code>boot_fdt</code> 是否为 yes 或者 try，根据 uboot 输出的环境变量信息可知 boot_fdt=try。因此会执行 4 行的语句。 第 4 行，运行环境变量 <code>loadfdt</code>，环境变量 <code>loadfdt</code> 定义如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loadfdt=fatload mmc $&#123;mmcdev&#125;:$&#123;mmcpart&#125; $&#123;fdt_addr&#125; $&#123;fdt_file&#125;</span><br></pre></td></tr></table></figure></li><li><p>展开以后就是：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loadfdt=fatload mmc 1:1 0x83000000 imx6ull-14x14-evk.dtb</span><br></pre></td></tr></table></figure></li><li><p>因此 <code>loadfdt</code> 的作用就是从 mmc1 的分区 1 中读取 <code>imx6ull-14x14-evk.dtb</code> 文件并放到 0x83000000 处。 第 8 行，如果读取.dtb 文件成功的话那就调用命令 bootz 启动 linux，调用方法如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bootz $&#123;loadaddr&#125; - $&#123;fdt_addr&#125;;</span><br></pre></td></tr></table></figure></li><li><p>展开就是：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bootz 0x80800000 - 0x83000000 (注意‘-’前后要有空格)</span><br></pre></td></tr></table></figure></li><li><p>至此 Linux 内核启动，如此复杂的设置就是为了从 EMMC 中读取 zImage 镜像文件和设备树文件。经过分析，浓缩出来的仅仅是 4 行精华：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mmc dev 1 //切换到 EMMC</span><br><span class="line">fatload mmc 1:1 0x80800000 zImage //读取 zImage 到 0x80800000 处</span><br><span class="line">fatload mmc 1:1 0x83000000 imx6ull-14x14-evk.dtb //读取设备树到 0x83000000 处</span><br><span class="line">bootz 0x80800000 - 0x83000000 //启动 Linux</span><br></pre></td></tr></table></figure></li><li><p>NXP 官方将 <code>CONFIG_BOOTCOMMAND</code> 写的这么复杂只有一个目的：为了兼容多个板子，所以写了个很复杂的脚本。当我们明确知道我们所使用的板子的时候就可以大幅简化宏 <code>CONFIG_BOOTCOMMAND</code> 的 设 置 ， 比 如 我 们 要 从 EMMC 启 动 ， 那 么 宏 <code>CONFIG_BOOTCOMMAND</code> 就可简化为：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">define CONFIG_BOOTCOMMAND \</span></span><br><span class="line"><span class="language-bash"> <span class="string">&quot;mmc dev 1;&quot;</span> \</span></span><br><span class="line"><span class="language-bash"> <span class="string">&quot;fatload mmc 1:1 0x80800000 zImage;&quot;</span> \</span></span><br><span class="line"><span class="language-bash"> <span class="string">&quot;fatload mmc 1:1 0x83000000 imx6ull-alientek-emmc.dtb;&quot;</span> \</span></span><br><span class="line"><span class="language-bash"> <span class="string">&quot;bootz 0x80800000 - 0x83000000;&quot;</span></span></span><br></pre></td></tr></table></figure></li><li><p>或者可以直接在 uboot 中设置 <code>bootcmd</code> 的值，这个值就是保存到 EMMC 中的，命令如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setenv bootcmd &#x27;mmc dev 1; fatload mmc 1:1 80800000 zImage; fatload mmc 1:1 83000000 imx6ull-alientek-emmc.dtb; bootz 80800000 - 83000000;&#x27;</span><br></pre></td></tr></table></figure></li></ul><h3 id="3-2-环境变量-bootargs">3.2 环境变量 bootargs</h3><ul><li><p><code>bootargs</code> 保存着 uboot 传递给 Linux 内核的参数，在上一小节讲解 <code>bootcmd</code> 的时候说过，<code>bootargs</code> 环境变量是由 <code>mmcargs</code> 设置的，<code>mmcargs</code> 环境变量如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mmcargs=setenv bootargs console=$&#123;console&#125;,$&#123;baudrate&#125; root=$&#123;mmcroot&#125;</span><br></pre></td></tr></table></figure></li><li><p>其中 <code>console=ttymxc0，baudrate=115200，mmcroot=/dev/mmcblk1p2 rootwait rw</code>，因此将 <code>mmcargs</code> 展开以后就是：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mmcargs=setenv bootargs console= ttymxc0, 115200 root= /dev/mmcblk1p2 rootwait rw</span><br></pre></td></tr></table></figure></li><li><p>可以看出环境变量 <code>mmcargs</code> 就是设置 <code>bootargs</code> 的值为<code>console= ttymxc0, 115200 root= /dev/mmcblk1p2 rootwait rw</code>，bootargs 就是设置了很多的参数的值，这些参数 Linux 内核会使用到，常用的参数有：</p></li></ul><ol><li>console<ul><li><strong>console 用来设置 linux 终端(或者叫控制台)，也就是通过什么设备来和 Linux 进行交互</strong>，是串口还是 LCD 屏幕？如果是串口的话应该是串口几等等。一般设置串口作为 Linux 终端，这样我们就可以在电脑上通过 SecureCRT 来和 linux 交互了。这里设置 console 为 <code>ttymxc0</code>，因为 linux 启动以后 I.MX6ULL 的串口 1 在 linux 下的设备文件就是<code>/dev/ttymxc0</code>，在 Linux 下，一切文件。 ttymxc0 后面有个“,115200”，这是设置串口的波特率，<code>console=ttymxc0,115200</code> 综合起来就是设置 ttymxc0（也就是串口 1）作为 Linux 的终端，并且串口波特率设置为 115200。</li></ul></li><li>root<ul><li><strong>root 用来设置根文件系统的位置</strong>，<code>root=/dev/mmcblk1p2</code> 用于指明根文件系统存放在 mmcblk1 设备的分区 2 中。EMMC 版本的核心板启动 linux 以后会存在/dev/mmcblk0、/dev/mmcblk1、/dev/mmcblk0p1、/dev/mmcblk0p2、/dev/mmcblk1p1 和/dev/mmcblk1p2 这样的文件，其中/dev/mmcblkx(x=0~n)表示 mmc 设备，而/dev/mmcblkxpy(x=0~n,y=1~n)表示 mmc 设备 x 的分区 y。在 I.MX6U-ALPHA 开发板中/dev/mmcblk1 表示 EMMC，而<code>/dev/mmcblk1p2</code> 表示 EMMC 的分区 2。</li><li>root 后面有<code>rootwait rw</code>，<strong>rootwait 表示等待 mmc 设备初始化完成以后再挂载</strong>，否则的话 mmc 设备还没初始化完成就挂载根文件系统会出错的。<strong>rw 表示根文件系统是可以读写的</strong>，不加 rw 的话可能无法在根文件系统中进行写操作，只能进行读操作。</li></ul></li><li>rootfstype<ul><li>此选项一般配置 root 一起使用，<code>rootfstype</code> 用于指定根文件系统类型，如果根文件系统为<code>ext</code> 格式的话此选项无所谓。如果根文件系统是 yaffs、jffs 或 ubifs 的话就需要设置此选项，指定根文件系统的类型。</li><li>bootargs 常设置的选项就这三个，后面遇到其他选项的话再讲解。</li></ul></li></ol><h2 id="4-uboot-启动-Linux-测试">4.uboot 启动 Linux 测试</h2><ul><li>uboot 已经移植好了，<code>bootcmd</code> 和 <code>bootargs</code> 这两个重要的环境变量也讲解了，接下来就要测试一下 uboot 能不能完成它的工作：启动 Linux 内核。我们测试两种启动 Linux 内核的方法，一种是直接从 EMMC 启动，一种是从网络启动</li></ul><h3 id="4-1-从-EMMC-启动-Linux-系统">4.1 从 EMMC 启动 Linux 系统</h3><ul><li><p>从 EMMC 启动也就是将编译出来的 Linux 镜像文件 <code>zImage</code> 和设备树文件保存在 EMMC 中，uboot 从 EMMC 中读取这两个文件并启动，这个是我们产品最终的启动方式。但是我们目前还没有讲解如何移植 linux 和设备树文件，以及如何将 <code>zImage</code> 和设备树文件保存到 EMMC 中。不过大家拿到手的 I.MX6U-ALPHA 开发板(EMMC 版本)已经将 <code>zImage</code> 文件和设备树文件烧写到了 EMMC 中，所以我们可以直接读取来测试。先检查一下 EMMC 的分区 1 中有没有 <code>zImage</code> 文件和设备树文件，输入命令<code>ls mmc 1:1</code>，结果如图所示：</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdnjson.com/images/2023/03/29/aa.webp" alt=""></p></li><li><p>从图中可以看出，此时 EMMC 分区 1 中存在 <code>zimage</code> 和 <code>imx6ull-alientek-emmc.dtb</code> 这两个文件，所以我们可以测试新移植的 uboot 能不能启动 linux 内核。设置 <code>bootargs</code> 和 <code>bootcmd</code> 这两个环境变量，设置如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">setenv bootargs &#x27;console=ttymxc0,115200 root=/dev/mmcblk1p2 rootwait rw&#x27;</span><br><span class="line">setenv bootcmd &#x27;mmc dev 1; fatload mmc 1:1 80800000 zImage; fatload mmc 1:1 83000000 imx6ull-alientek-emmc.dtb; bootz 80800000 - 83000000;&#x27;</span><br><span class="line">saveenv</span><br></pre></td></tr></table></figure></li><li><p>设置好以后直接输入 <code>boot</code>，或者 <code>run bootcmd</code> 即可启动 Linux 内核，如果 Linux 内核启动成功的话就会输出如图所示的启动信息：</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdnjson.com/images/2023/03/29/pic2.webp" alt=""></p></li></ul><h3 id="4-2-从网络启动-Linux-系统">4.2 从网络启动 Linux 系统</h3><ul><li><p>从网络启动 linux 系统的唯一目的就是为了调试！不管是为了调试 linux 系统还是 linux 下的驱动。每次修改 linux 系统文件或者 linux 下的某个驱动以后都要将其烧写到 EMMC 中去测试，这样太麻烦了。我们可以设置 linux 从网络启动，也就是将 linux 镜像文件和根文件系统都放到 Ubuntu 下某个指定的文件夹中，这样每次重新编译 linux 内核或者某个 linux 驱动以后只需要使用 cp 命令将其拷贝到这个指定的文件夹中即可，这样就不用需要频繁的烧写 EMMC，这样就加快了开发速度。我们可以通过 nfs 或者 tftp 从 Ubuntu 中下载 <code>zImage</code> 和设备树文件，根文件系统的话也可以通过 nfs 挂载，不过本节我们不讲解如何通过 nfs 挂载根文件系统，这个在讲解根文件系统移植的时候再讲解。这里我们使用 <code>tftp</code> 从 Ubuntu 中下载 <code>zImage</code> 和设备树文件，前提是要将 zImage 和设备树文件放到 Ubuntu 下的 <code>tftp</code> 目录中。设置 <code>bootargs</code> 和 <code>bootcmd</code> 这两个环境变量，设置如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">setenv bootargs &#x27;console=ttymxc0,115200 root=/dev/mmcblk1p2 rootwait rw&#x27;</span><br><span class="line">setenv bootcmd &#x27;tftp 80800000 zImage; tftp 83000000 imx6ull-alientek-emmc.dtb; bootz 80800000 - 83000000&#x27;</span><br><span class="line">saveenv</span><br></pre></td></tr></table></figure></li><li><p>一开始是通过 tftp 下载 <code>zImage</code> 和 <code>imx6ull-alientek-emmc.dtb</code> 这两个文件，过程如下图所示：</p></li></ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdnjson.com/images/2023/03/29/pic3.webp" alt=""></p><ul><li><p>下载完成以后就是启动 Linux 内核，启动过程如图 33.4.2.2 所示：</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdnjson.com/images/2023/03/29/pic4.webp" alt=""></p><h2 id="5-总结">5.总结</h2><ul><li><p><span style="color:red;font-weight:700">uboot 移植到此结束，简单总结一下 uboot 移植的过程：</span></p><ol><li><p>不管是购买的开发板还是自己做的开发板，基本都是参考半导体厂商的 demo 板，而半导体厂商会在他们自己的开发板上移植好 <code>uboot</code>、<code>linux kernel</code> 和 <code>rootfs</code> 等，最终制作好 BSP 包提供给用户。我们可以在官方提供的 BSP 包的基础上添加我们的板子，也就是俗称的移植。</p></li><li><p>我们购买的开发板或者自己做的板子一般都不会原封不动的照抄半导体厂商的 demo 板，都会根据实际的情况来做修改，既然有修改就必然涉及到 uboot 下驱动的移植。</p></li><li><p>一般 uboot 中需要解决<strong>串口、NAND、EMMC 或 SD 卡、网络和 LCD 驱动</strong>，因为 uboot 的主要目的就是启动 Linux 内核，所以不需要考虑太多的外设驱动。</p></li><li><p>在 uboot 中添加自己的板子信息，根据自己板子的实际情况来修改 uboot 中的驱动。</p></li></ol></li></ul></li></ul></article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info"><h>Linux系统移植篇(一)——Uboot移植</h></span></div><div class="post-copyright__type"><span class="post-copyright-info"><a href="https://www.fomal.cc/posts/9e744961.html">https://www.fomal.cc/posts/9e744961.html</a></span></div><div class="post-copyright-m"><div class="post-copyright-m-info"><div class="post-copyright-a"><h>作者</h><div class="post-copyright-cc-info"><h>Fomalhaut🥝</h></div></div><div class="post-copyright-c"><h>发布于</h><div class="post-copyright-cc-info"><h>2023-03-28</h></div></div><div class="post-copyright-u"><h>更新于</h><div class="post-copyright-cc-info"><h>2023-04-01</h></div></div><div class="post-copyright-c"><h>许可协议</h><div class="post-copyright-cc-info"><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a rel="noopener" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></div></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/"><div class="tags-punctuation"><svg class="faa-tada icon" style="height:1.1em;width:1.1em;fill:currentColor;position:relative;top:2px;margin-right:3px" aria-hidden="true"><use xlink:href="#icon-sekuaibiaoqian"></use></svg></div>嵌入式</a><a class="post-meta__tags" href="/tags/Linux%E9%A9%B1%E5%8A%A8/"><div class="tags-punctuation"><svg class="faa-tada icon" style="height:1.1em;width:1.1em;fill:currentColor;position:relative;top:2px;margin-right:3px" aria-hidden="true"><use xlink:href="#icon-sekuaibiaoqian"></use></svg></div>Linux驱动</a></div></div><link rel="stylesheet" href="/css/coin.css" media="defer" onload='this.media="all"'><div class="post-reward"><button class="tip-button reward-button"><span class="tip-button__text">投喂作者</span><div class="coin-wrapper"><div class="coin"><div class="coin__middle"></div><div class="coin__back"></div><div class="coin__front"></div></div></div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://tuchuang.voooe.cn/images/2023/01/04/2.webp" target="_blank"><img class="post-qr-code-img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://tuchuang.voooe.cn/images/2023/01/04/2.webp" alt="微信"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://tuchuang.voooe.cn/images/2023/01/04/20f8e49805975b8f8.webp" target="_blank"><img class="post-qr-code-img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://tuchuang.voooe.cn/images/2023/01/04/20f8e49805975b8f8.webp" alt="支付宝"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></button></div><audio id="coinAudio" src="https://npm.elemecdn.com/akilar-candyassets@1.0.36/audio/aowu.m4a"></audio><script defer src="/js/coin.js"></script><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/7aaa16c1.html"><img class="prev-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.bitiful.net/img/default_cover_74.webp" onerror='onerror=null,src="/assets/r2.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Linux系统移植篇(二)——Linux内核移植</div></div></a></div><div class="next-post pull-right"><a href="/posts/74ac8dc8.html"><img class="next-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.bitiful.net/img/default_cover_213.webp" onerror='onerror=null,src="/assets/r2.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">无服务器部署自己的chatGPT</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/c59270e7.html" title="Linux驱动基础知识"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.bitiful.net/img/default_cover_143.webp" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2023-03-19</div><div class="title">Linux驱动基础知识</div></div></a></div><div><a href="/posts/dd1040c8.html" title="Linux驱动模型详解"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.bitiful.net/img/default_cover_143.webp" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2023-03-19</div><div class="title">Linux驱动模型详解</div></div></a></div><div><a href="/posts/7aaa16c1.html" title="Linux系统移植篇(二)——Linux内核移植"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.bitiful.net/img/default_cover_74.webp" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2023-04-01</div><div class="title">Linux系统移植篇(二)——Linux内核移植</div></div></a></div><div><a href="/posts/92cc006e.html" title="Linux系统移植篇(三)——根文件系统的构建"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.bitiful.net/img/default_cover_199.webp" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2023-04-01</div><div class="title">Linux系统移植篇(三)——根文件系统的构建</div></div></a></div><div><a href="/posts/c570025b.html" title="ARM体系架构知识点总结"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.bitiful.net/img/default_cover_109.webp" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2023-03-19</div><div class="title">ARM体系架构知识点总结</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i> <span>评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><svg class="meta_icon" style="width:22px;height:22px;position:relative;top:5px"><use xlink:href="#icon-mulu1"></use></svg><span style="font-weight:700">目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-NXP-%E5%AE%98%E6%96%B9%E5%BC%80%E5%8F%91%E6%9D%BF-uboot-%E7%BC%96%E8%AF%91%E6%B5%8B%E8%AF%95"><span class="toc-text">1.NXP 官方开发板 uboot 编译测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E6%9F%A5%E6%89%BE-NXP-%E5%AE%98%E6%96%B9%E7%9A%84%E5%BC%80%E5%8F%91%E6%9D%BF%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">1.1 查找 NXP 官方的开发板默认配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E7%BC%96%E8%AF%91-NXP-%E5%AE%98%E6%96%B9%E5%BC%80%E5%8F%91%E6%9D%BF%E5%AF%B9%E5%BA%94%E7%9A%84-uboot"><span class="toc-text">1.2 编译 NXP 官方开发板对应的 uboot</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E7%83%A7%E5%86%99%E9%AA%8C%E8%AF%81%E4%B8%8E%E9%A9%B1%E5%8A%A8%E6%B5%8B%E8%AF%95"><span class="toc-text">1.3 烧写验证与驱动测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%9C%A8-U-Boot-%E4%B8%AD%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%B7%B1%E7%9A%84%E5%BC%80%E5%8F%91%E6%9D%BF"><span class="toc-text">2.在 U-Boot 中添加自己的开发板</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E6%B7%BB%E5%8A%A0%E5%BC%80%E5%8F%91%E6%9D%BF%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">2.1 添加开发板默认配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E6%B7%BB%E5%8A%A0%E5%BC%80%E5%8F%91%E6%9D%BF%E5%AF%B9%E5%BA%94%E7%9A%84%E5%A4%B4%E6%96%87%E4%BB%B6"><span class="toc-text">2.2 添加开发板对应的头文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E6%B7%BB%E5%8A%A0%E5%BC%80%E5%8F%91%E6%9D%BF%E5%AF%B9%E5%BA%94%E7%9A%84%E6%9D%BF%E7%BA%A7%E6%96%87%E4%BB%B6%E5%A4%B9"><span class="toc-text">2.3 添加开发板对应的板级文件夹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-%E4%BF%AE%E6%94%B9-U-Boot-%E5%9B%BE%E5%BD%A2%E7%95%8C%E9%9D%A2%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">2.4 修改 U-Boot 图形界面配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-%E4%BD%BF%E7%94%A8%E6%96%B0%E6%B7%BB%E5%8A%A0%E7%9A%84%E6%9D%BF%E5%AD%90%E9%85%8D%E7%BD%AE%E7%BC%96%E8%AF%91-uboot"><span class="toc-text">2.5 使用新添加的板子配置编译 uboot</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-LCD-%E9%A9%B1%E5%8A%A8%E4%BF%AE%E6%94%B9"><span class="toc-text">2.6 LCD 驱动修改</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-7-%E5%BA%95%E6%9D%BF%E7%BD%91%E7%BB%9C%E9%A9%B1%E5%8A%A8%E4%BF%AE%E6%94%B9"><span class="toc-text">2.7 底板网络驱动修改</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-8-%E5%85%B6%E4%BB%96%E9%9C%80%E8%A6%81%E4%BF%AE%E6%94%B9%E7%9A%84%E5%9C%B0%E6%96%B9"><span class="toc-text">2.8 其他需要修改的地方</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-bootcmd-%E5%92%8C-bootargs-%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-text">3.bootcmd 和 bootargs 环境变量</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F-bootcmd"><span class="toc-text">3.1 环境变量 bootcmd</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F-bootargs"><span class="toc-text">3.2 环境变量 bootargs</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-uboot-%E5%90%AF%E5%8A%A8-Linux-%E6%B5%8B%E8%AF%95"><span class="toc-text">4.uboot 启动 Linux 测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E4%BB%8E-EMMC-%E5%90%AF%E5%8A%A8-Linux-%E7%B3%BB%E7%BB%9F"><span class="toc-text">4.1 从 EMMC 启动 Linux 系统</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E4%BB%8E%E7%BD%91%E7%BB%9C%E5%90%AF%E5%8A%A8-Linux-%E7%B3%BB%E7%BB%9F"><span class="toc-text">4.2 从网络启动 Linux 系统</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E6%80%BB%E7%BB%93"><span class="toc-text">5.总结</span></a></li></ol></div></div></div></div></main><footer id="footer" style="background-color:transparent"><div id="footer-wrap"><div id="ft"><div class="ft-item-1"><div class="t-top"><div class="t-t-l"><p class="ft-t t-l-t">格言🧬</p><div class="bg-ad"><div>再看看那个光点，它就在这里，这是家园，这是我们 —— 你所爱的每一个人，你认识的每一个人，你听说过的每一个人，曾经有过的每一个人，都在它上面度过他们的一生✨</div><div class="btn-xz-box"><a class="btn-xz" target="_blank" rel="noopener" href="https://stellarium.org/">点击开启星辰之旅</a></div></div></div><div class="t-t-r"><p class="ft-t t-l-t">猜你想看💡</p><ul class="ft-links"><li><a href="/posts/76815704.html">开源指南</a><a href="/box/nav/">网址导航</a></li><li><a href="/social/link/">我的朋友</a><a href="/comments/">留点什么</a></li><li><a href="/personal/about/">关于作者</a><a href="/archives/">文章归档</a></li><li><a href="/categories/">文章分类</a><a href="/tags/">文章标签</a></li><li><a href="/box/gallery/">我的画廊</a><a href="/personal/bb/">我的唠叨</a></li><li><a href="/site/time/">建设进程</a><a href="/site/census/">网站统计</a></li></ul></div></div></div><div class="ft-item-2"><p class="ft-t">推荐友链⌛</p><div class="ft-img-group"><div class="img-group-item"><a href="https://www.fomal.cc/" title="Fomalhaut🥝"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.bitiful.net/img/avatar.webp" alt=""></a></div><div class="img-group-item"><a target="_blank" rel="noopener" href="https://butterfly.js.org/" title="Butterfly"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.bitiful.net/img/jerry.png" alt=""></a></div><div class="img-group-item"><a target="_blank" rel="noopener" href="https://fe32.top/" title="唐志远の博客"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.bitiful.net/img/tzy.webp" alt=""></a></div><div class="img-group-item"><a target="_blank" rel="noopener" href="https://akilar.top/" title="Akilarの糖果屋"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.bitiful.net/img/akilar.jpg" alt=""></a></div><div class="img-group-item"><a target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="安知鱼"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.bitiful.net/img/anzhiyu.jpg" alt=""></a></div><div class="img-group-item"><a target="_blank" rel="noopener" href="https://www.startly.cn/" title="小染Blog"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.bitiful.net/img/xiaoqi.webp" alt=""></a></div><div class="img-group-item"><a target="_blank" rel="noopener" href="https://blog.leonus.cn/" title="Leonus"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.bitiful.net/img/leonus.webp" alt=""></a></div><div class="img-group-item"><a target="_blank" rel="noopener" href="https://cloud.firstdyeing.com/" title="初柒工坊云"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.bitiful.net/img/chuqi.webp" alt=""></a></div></div></div></div><div class="copyright"><span><b>&copy;2022-2023</b></span><span><b>&nbsp;&nbsp;By Fomalhaut🥝</b></span></div><div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" title="博客框架为Hexo_v6.3.0"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.bitiful.net/badge/Frame-Hexo-blue.svg" alt=""></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" title="主题版本Butterfly_v4.3.1"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.bitiful.net/badge/Theme-Butterfly-6513df.svg" alt=""></a><a class="github-badge" target="_blank" href="https://vercel.com/" style="margin-inline:5px" title="本站采用多线部署，主线路托管于Vercel"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.bitiful.net/badge/Hosted-Vercel-brightgreen.svg" alt=""></a><a class="github-badge" target="_blank" href="https://user.51.la/" style="margin-inline:5px" title="本站数据分析得益于51la技术支持"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.bitiful.net/badge/Analytics-51la-3db1eb.svg" alt=""></a><a class="github-badge" target="_blank" href="https://icp.gov.moe/?keyword=20226665" style="margin-inline:5px" title="本站已加入萌ICP豪华套餐，萌ICP备20226665号"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.bitiful.net/badge/萌ICP备-20226665-fe1384.svg" alt=""></a><a class="github-badge" target="_blank" href="https://bitiful.dogecast.com/buckets" style="margin-inline:5px" title="本网站经Service Worker分流至缤纷云对象存储"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=" https://sourcebucket.s3.bitiful.net/badge/Bucket-缤纷云-9c62da.svg" alt=""></a><a class="github-badge" target="_blank" href="https://tianli-blog.club/jsd/" style="margin-inline:5px" title="本站使用TianliCDN为部分静态资源加速"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.bitiful.net/badge/CDN-TianliCDN.svg" alt=""></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" title="本网站源码由Github提供存储仓库"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.bitiful.net/badge/Source-Github-d021d6.svg" alt=""></a></p></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><a class="icon-V hidden" onclick="switchNightMode()" title="浅色和深色模式转换"><svg width="25" height="25" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon"></use></svg></a><button class="share" type="button" title="右键模式" onclick="changeMouseMode()"><i class="fas fa-mouse"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog right_side"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button class="share" type="button" title="分享链接" onclick="share()"><i class="fas fa-share-nodes"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i><span id="percent">0<span>%</span></span></button><button id="go-down" type="button" title="直达底部" onclick="btf.scrollToDest(document.body.scrollHeight,500)"><i class="fas fa-arrow-down"></i></button></div></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div class="js-pjax" id="rightMenu"><div class="rightMenu-group rightMenu-small"><a class="rightMenu-item" href="javascript:window.history.back();"><i class="fa fa-arrow-left"></i></a><a class="rightMenu-item" href="javascript:window.history.forward();"><i class="fa fa-arrow-right"></i></a><a class="rightMenu-item" href="javascript:window.location.reload();"><i class="fa fa-refresh"></i></a><a class="rightMenu-item" href="javascript:rmf.scrollToTop();"><i class="fa fa-arrow-up"></i></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-text"><a class="rightMenu-item" href="javascript:rmf.copySelect();"><i class="fa fa-copy"></i><span>复制</span></a><a class="rightMenu-item" href="javascript:window.open(&quot;https://www.baidu.com/s?wd=&quot;+window.getSelection().toString());window.location.reload();"><i class="fa fa-search"></i><span>百度搜索</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-too"><a class="rightMenu-item" href="javascript:window.open(window.getSelection().toString());window.location.reload();"><i class="fa fa-link"></i><span>转到链接</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-paste"><a class="rightMenu-item" href="javascript:rmf.paste()"><i class="fa fa-copy"></i><span>粘贴</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-post"><a class="rightMenu-item" href="#post-comment"><i class="fas fa-comment"></i><span>空降评论</span></a><a class="rightMenu-item" href="javascript:rmf.copyWordsLink()"><i class="fa fa-link"></i><span>复制本文地址</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-to"><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>新窗口打开</span></a><a class="rightMenu-item" id="menu-too" href="javascript:rmf.open()"><i class="fa fa-link"></i><span>转到链接</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>复制链接</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-img"><a class="rightMenu-item" href="javascript:rmf.saveAs()"><i class="fa fa-download"></i><span>保存图片</span></a><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>在新窗口打开</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>复制图片链接</span></a></div><div class="rightMenu-group rightMenu-line"><a class="rightMenu-item" href="javascript:randomPost()"><i class="fa fa-paper-plane"></i><span>随便逛逛</span></a><a class="rightMenu-item" href="javascript:switchNightMode();"><i class="fa fa-moon"></i><span>昼夜切换</span></a><a class="rightMenu-item" href="/personal/about/"><i class="fa fa-info-circle"></i><span>关于博客</span></a><a class="rightMenu-item" href="javascript:toggleWinbox();"><i class="fas fa-cog"></i><span>美化设置</span></a><a class="rightMenu-item" href="javascript:rmf.fullScreen();"><i class="fas fa-expand"></i><span>切换全屏</span></a><a class="rightMenu-item" href="javascript:window.print();"><i class="fa-solid fa-print"></i><span>打印页面</span></a></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.umd.min.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/instant.page/5.1.0/instantpage.min.js" type="module"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/vanilla-lazyload/17.3.1/lazyload.iife.min.js"></script><script src="https://cdn.staticfile.org/algoliasearch/4.14.3/algoliasearch-lite.umd.min.js"></script><script src="https://cdn.staticfile.org/instantsearch.js/4.49.2/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><script async>var preloader={endLoading:()=>{document.body.style.overflow="auto",document.getElementById("loading-box").classList.add("loaded")},initLoading:()=>{document.body.style.overflow="",document.getElementById("loading-box").classList.remove("loaded")}};window.addEventListener("load",preloader.endLoading()),setTimeout((function(){preloader.endLoading()}),5e3),document.getElementById("loading-box").addEventListener("click",(()=>{preloader.endLoading()}))</script><div class="js-pjax"><script>(()=>{const t=()=>{twikoo.init(Object.assign({el:"#twikoo-wrap",envId:"https://comment.fomal.cc",region:"",onCommentLoaded:function(){btf.loadLightbox(document.querySelectorAll("#twikoo .tk-content img:not(.tk-owo-emotion)"))}},null))},o=()=>{"object"!=typeof twikoo?getScript("https://cdn.staticfile.org/twikoo/1.6.17/twikoo.all.min.js").then(t):setTimeout(t,0)};btf.loadComment(document.getElementById("twikoo-wrap"),o)})()</script></div><script charset="UTF-8" id="LA_COLLECT" src="https://sdk.51.la/js-sdk-pro.min.js"></script><script src="https://sdk.51.la/perf/js-sdk-perf.min.js" crossorigin="anonymous"></script><script defer src="/js/51la.js"></script><script src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/jquery/3.6.0/jquery.min.js"></script><script async src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/vue/2.6.14/vue.min.js"></script><script async src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/element-ui/2.15.7/index.js"></script><script async src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/clipboard.js/2.0.10/clipboard.min.js"></script><script defer src="https://cdn.tianli0.top/npm/sweetalert2@8.19.0/dist/sweetalert2.all.js"></script><script async src="https://npm.elemecdn.com/pace-js@1.2.4/pace.min.js"></script><script defer src="https://cdn.tianli0.top/gh/nextapps-de/winbox/dist/winbox.bundle.min.js"></script><script async src="//at.alicdn.com/t/c/font_3586335_hsivh70x0fm.js"></script><script async src="//at.alicdn.com/t/c/font_3636804_glcijzcpx7f.js"></script><script async src="//at.alicdn.com/t/c/font_3612150_gkavascgf3n.js"></script><canvas id="universe"></canvas><canvas id="snow"></canvas><script defer src="/js/fomal.js"></script><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.css" media="print" onload='this.media="all"'><script src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.js"></script><script src="https://cdn.tianli0.top/npm/js-heo@1.0.12/metingjs/Meting.min.js"></script><script src="https://lib.baomitu.com/pjax/0.2.8/pjax.min.js"></script><script>let pjaxSelectors=["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show","#web_bg",".js-pjax","#bibi","body > title","#app","#tag-echarts","#posts-echart","#categories-echarts"];var pjax=new Pjax({elements:'a:not([target="_blank"])',selectors:pjaxSelectors,cacheBust:!1,analytics:!1,scrollRestoration:!1});document.addEventListener("pjax:send",(function(){if(window.tocScrollFn&&window.removeEventListener("scroll",window.tocScrollFn),window.scrollCollect&&window.removeEventListener("scroll",scrollCollect),"object"==typeof preloader&&preloader.initLoading(),document.getElementById("rightside").style.cssText="opacity: ''; transform: ''",window.aplayers)for(let e=0;e<window.aplayers.length;e++)window.aplayers[e].options.fixed||window.aplayers[e].destroy();"object"==typeof typed&&typed.destroy();const e=document.body.classList;e.contains("read-mode")&&e.remove("read-mode"),"object"==typeof disqusjs&&disqusjs.destroy()})),document.addEventListener("pjax:complete",(function(){window.refreshFn(),document.querySelectorAll("script[data-pjax]").forEach((e=>{const t=document.createElement("script"),o=e.text||e.textContent||e.innerHTML||"";Array.from(e.attributes).forEach((e=>t.setAttribute(e.name,e.value))),t.appendChild(document.createTextNode(o)),e.parentNode.replaceChild(t,e)})),GLOBAL_CONFIG.islazyload&&window.lazyLoadInstance.update(),"function"==typeof chatBtnFn&&chatBtnFn(),"function"==typeof panguInit&&panguInit(),"function"==typeof gtag&&gtag("config","",{page_path:window.location.pathname}),"object"==typeof _hmt&&_hmt.push(["_trackPageview",window.location.pathname]),"function"==typeof loadMeting&&document.getElementsByClassName("aplayer").length&&loadMeting(),"object"==typeof Prism&&Prism.highlightAll(),"object"==typeof preloader&&preloader.endLoading()})),document.addEventListener("pjax:error",(e=>{404===e.request.status&&pjax.loadUrl("/404.html")}))</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script data-pjax>if(document.getElementById("recent-posts")&&"/"===location.pathname){var parent=document.getElementById("recent-posts"),child='<div class="recent-post-item" style="width:100%;height: auto"><div id="catalog_magnet"><div class="magnet_item"><a class="magnet_link" href="https://www.fomal.cc/categories/算法/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🍡 小Fの算法学习笔记 (24)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://www.fomal.cc/categories/计算机基础/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🍼 小Fの计算机基础笔记 (1)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://www.fomal.cc/categories/魔改教程/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🍉 小Fの博客魔改教程 (13)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://www.fomal.cc/categories/Java基础/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🍟 小FのJava基础笔记 (1)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://www.fomal.cc/categories/数据库/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🍨 小Fの数据库笔记 (1)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://www.fomal.cc/categories/嵌入式知识点总结/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🧀 小Fの嵌入式知识总结 (6)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><a class="magnet_link_more"  href="https://www.fomal.cc/categories/" style="flex:1;text-align: center;margin-bottom: 10px;">查看更多...</a></div></div>';console.log("已挂载magnet"),parent.insertAdjacentHTML("afterbegin",child)}</script><style>#catalog_magnet{flex-wrap:wrap;display:flex;width:100%;justify-content:space-between;padding:10px 10px 0 10px;align-content:flex-start}.magnet_item{flex-basis:calc(33.333333333333336% - 5px);background:#e9e9e9;margin-bottom:10px;border-radius:8px;transition:all .2s ease-in-out}.magnet_item:hover{background:var(--text-bg-hover)}.magnet_link_more{color:#555}.magnet_link{color:#000}.magnet_link:hover{color:#fff}@media screen and (max-width:600px){.magnet_item{flex-basis:100%}}.magnet_link_context{display:flex;padding:10px;font-size:16px;transition:all .2s ease-in-out}.magnet_link_context:hover{padding:10px 20px}</style><style></style><script data-pjax>function butterfly_swiper_injector_config(){var t=document.getElementById("recent-posts");console.log("已挂载butterfly_swiper"),t.insertAdjacentHTML("afterbegin",'<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/dd1040c8.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.bitiful.net/img/default_cover_143.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-03-19</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/dd1040c8.html&quot;);" href="javascript:void(0);" alt="">Linux驱动模型详解</a><div class="blog-slider__text">🍃本文将总结Linux驱动模型相关知识</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/dd1040c8.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/c59270e7.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.bitiful.net/img/default_cover_143.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-03-19</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/c59270e7.html&quot;);" href="javascript:void(0);" alt="">Linux驱动基础知识</a><div class="blog-slider__text">🍁本文将总结Linux驱动相关基础知识</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/c59270e7.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/76815704.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.bitiful.net/img/default_cover_127.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-03-05</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/76815704.html&quot;);" href="javascript:void(0);" alt="">网站开源文档</a><div class="blog-slider__text">🍠网站的源码详细参考文档，本文章会长期更新</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/76815704.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/c570025b.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.bitiful.net/img/default_cover_109.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-03-05</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/c570025b.html&quot;);" href="javascript:void(0);" alt="">ARM体系架构知识点总结</a><div class="blog-slider__text">🌌本文将总结ARM体系架构相关基础知识</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/c570025b.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/9ac969bb.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.bitiful.net/img/default_cover_178.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-12-31</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/9ac969bb.html&quot;);" href="javascript:void(0);" alt="">综合美化模块教程</a><div class="blog-slider__text">🎨基于winbox的二次开发——综合美化模块教程</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/9ac969bb.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/d7fb1ba1.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.bitiful.net/img/default_cover_251.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-12-03</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/d7fb1ba1.html&quot;);" href="javascript:void(0);" alt="">免费图床综合教程</a><div class="blog-slider__text">🍝本教程汇总了本人所知道和使用过的免费图床详细使用方法</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/d7fb1ba1.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/b48804d5.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.bitiful.net/img/default_cover_42.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-10-23</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/b48804d5.html&quot;);" href="javascript:void(0);" alt="">网站性能优化的一些小技巧</a><div class="blog-slider__text">🍔这篇文章将从理论和实际来提升你网站的性能</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/b48804d5.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/63fc9391.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.bitiful.net/img/default_cover_45.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-08-11</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/63fc9391.html&quot;);" href="javascript:void(0);" alt="">滑动窗口专题</a><div class="blog-slider__text">🍇这篇文章分享一个滑动窗口的模板，能解决大多数的滑动窗口问题</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/63fc9391.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/2013454d.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.bitiful.net/img/default_cover_138.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-08-09</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/2013454d.html&quot;);" href="javascript:void(0);" alt="">Markdown语法与外挂标签写法汇总</a><div class="blog-slider__text">🥧本文汇总Markdown格式以及外挂标签在网页端的渲染效果，可作为文档进行查询</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/2013454d.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/e88c5782.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.bitiful.net/img/default_cover_192.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-08-11</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/e88c5782.html&quot;);" href="javascript:void(0);" alt="">单调栈总结</a><div class="blog-slider__text">🍰单调栈的作用是及时弹出没用的元素，用来降低算法的时间复杂度</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/e88c5782.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>')}for(var elist="undefined".split(","),cpage=location.pathname,epage="/",flag=0,i=0;i<elist.length;i++)cpage.includes(elist[i])&&flag++;("all"===epage&&0==flag||epage===cpage)&&butterfly_swiper_injector_config()</script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><div class="js-pjax"><script async>for(var arr=document.getElementsByClassName("recent-post-item"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__zoomIn"),arr[i].setAttribute("data-wow-duration","2s"),arr[i].setAttribute("data-wow-delay","200ms"),arr[i].setAttribute("data-wow-offset","30"),arr[i].setAttribute("data-wow-iteration","1")</script><script async>for(var arr=document.getElementsByClassName("card-widget"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__zoomIn"),arr[i].setAttribute("data-wow-duration","2s"),arr[i].setAttribute("data-wow-delay","200ms"),arr[i].setAttribute("data-wow-offset","30"),arr[i].setAttribute("data-wow-iteration","1")</script></div><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js"></script><script data-pjax src="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.js"></script><script data-pjax>function gitcalendar_injector_config(){document.getElementById("gitZone").insertAdjacentHTML("afterbegin",'<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><style>#git_container{min-height: 320px}@media screen and (max-width:650px) {#git_container{min-height: 0px}}</style><div id="git_loading" style="width:10%;height:100%;margin:0 auto;display: block;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animatetransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animatetransform></path></svg><style>#git_container{display: none;}</style></div><div id="git_container"></div></div>'),console.log("已挂载gitcalendar")}document.getElementById("gitZone")&&"/site/census/"===location.pathname&&(gitcalendar_injector_config(),GitCalendarInit("https://gitcalendar.fomal.cc/api?fomalhaut1998",["#d9e0df","#c6e0dc","#a8dcd4","#9adcd2","#89ded1","#77e0d0","#5fdecb","#47dcc6","#39dcc3","#1fdabe","#00dab9"],"fomalhaut1998"))</script></body></html>